‚
E:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Exceptions\EntityNotFoundException.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Exceptions  
{ 
public 

class #
EntityNotFoundException (
:) *
	Exception+ 4
{ 
public #
EntityNotFoundException &
(& '
)' (
{) *
}+ ,
public #
EntityNotFoundException &
(& '
string' -
message. 5
)5 6
:7 8
base9 =
(= >
message> E
)E F
{G H
}I J
public #
EntityNotFoundException &
(& '
string' -
message. 5
,5 6
	Exception7 @
innerExceptionA O
)O P
:Q R
baseS W
(W X
messageX _
,_ `
innerExceptiona o
)o p
{q r
}s t
} 
}		 Ì
ÅE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Exceptions\InvalidParameterException.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Exceptions  
{ 
public 

class %
InvalidParameterException *
:+ ,
	Exception- 6
{ 
public %
InvalidParameterException (
(( )
)) *
{+ ,
}- .
public %
InvalidParameterException (
(( )
string) /
message0 7
)7 8
:9 :
base; ?
(? @
message@ G
)G H
{I J
}K L
public %
InvalidParameterException (
(( )
string) /
message0 7
,7 8
	Exception9 B
innerExceptionC Q
)Q R
:S T
baseU Y
(Y Z
messageZ a
,a b
innerExceptionc q
)q r
{s t
}u v
} 
}		 Ë
ÄE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Exceptions\ValidationErrorException.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Exceptions  
{ 
public		 

class		 $
ValidationErrorException		 )
:		* +
	Exception		, 5
{

 
public $
ValidationErrorException '
(' (
)( )
{* +
}, -
public $
ValidationErrorException '
(' (
string( .
message/ 6
)6 7
:8 9
base: >
(> ?
message? F
)F G
{H I
}J K
public $
ValidationErrorException '
(' (
string( .
message/ 6
,6 7
	Exception8 A
innerExceptionB P
)P Q
:R S
baseT X
(X Y
messageY `
,` a
innerExceptionb p
)p q
{r s
}t u
} 
} ¡
ÅE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Extensions\ClaimsPrincipalExtensions.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Extensions  
{		 
public

 

static

 
class

 %
ClaimsPrincipalExtensions

 1
{ 
public 
static 
string 
GetUserIdFromJwt -
(- .
this. 2
ClaimsPrincipal3 B
claimsPrincipalC R
)R S
{ 	
return 
claimsPrincipal "
." #
Claims# )
.) *
First* /
(/ 0
x0 1
=>2 4
x5 6
.6 7
Type7 ;
==< >
$str? D
)D E
.E F
ValueF K
;K L
} 	
public 
static 
string 
GetUserRoleFromJwt /
(/ 0
this0 4
ClaimsPrincipal5 D
claimsPrincipalE T
)T U
{ 	
return 
claimsPrincipal "
." #
Claims# )
.) *
First* /
(/ 0
x0 1
=>2 4
x5 6
.6 7
Type7 ;
==< >
$str? E
)E F
.F G
ValueG L
;L M
} 	
} 
} ´Â
~E:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\CaffCommandHandler.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
{ 
public   

class   
CaffCommandHandler   #
:  $ %
IRequestHandler!! 
<!!  
RemoveCommentCommand!! ,
,!!, -
Unit!!. 2
>!!2 3
,!!3 4
IRequestHandler"" 
<"" 
PostCommentCommand"" *
,""* +
Unit"", 0
>""0 1
,""1 2
IRequestHandler## 
<## 
UploadCaffCommand## )
,##) *
Guid##+ /
>##/ 0
,##0 1
IRequestHandler$$ 
<$$ 
DeleteCaffCommand$$ )
,$$) *
Unit$$+ /
>$$/ 0
,$$0 1
IRequestHandler%% 
<%% 
BuyCaffCommand%% &
,%%& '
Unit%%( ,
>%%, -
,%%- .
IRequestHandler&& 
<&& 
EditCaffDataCommand&& +
,&&+ ,
Unit&&- 1
>&&1 2
{'' 
private(( 
readonly(( 
IUnitOfWork(( $
_unitOfWork((% 0
;((0 1
private)) 
readonly)) 
IFileRepository)) (
_fileRepository))) 8
;))8 9
private** 
readonly** (
IWebshopConfigurationService** 5!
_webshopConfiguration**6 K
;**K L
private++ 
readonly++ 
IMapper++  
_mapper++! (
;++( )
private,, 

IValidator,, 
?,, 

_validator,, &
;,,& '
[.. 	
	DllImport..	 
(.. 
$str.. #
,..# $
CharSet..% ,
=..- .
CharSet../ 6
...6 7
Ansi..7 ;
)..; <
]..< =
static// 
extern// 
int// 
readCaff// "
(//" #
[//# $
In//$ &
]//& '
StringBuilder//( 5
inPath//6 <
,//< =
[//> ?
In//? A
]//A B
StringBuilder//C P
caffName//Q Y
,//Y Z
[//[ \
In//\ ^
]//^ _
StringBuilder//` m
outPath//n u
,//u v
[//w x
In//x z
,//z {
Out//| 
]	// Ä
ref
//Å Ñ
int
//Ö à
	ciffCount
//â í
)
//í ì
;
//ì î
public11 
CaffCommandHandler11 !
(11! "
IUnitOfWork22 

unitOfWork22 "
,22" #
IFileRepository33 
fileRepository33 *
,33* +(
IWebshopConfigurationService44 ( 
webshopConfiguration44) =
,44= >
IMapper55 
mapper55 
)66 
{77 	
_unitOfWork88 
=88 

unitOfWork88 $
;88$ %
_fileRepository99 
=99 
fileRepository99 ,
;99, -!
_webshopConfiguration:: !
=::" # 
webshopConfiguration::$ 8
;::8 9
_mapper;; 
=;; 
mapper;; 
;;; 
}<< 	
public>> 
async>> 
Task>> 
<>> 
Unit>> 
>>> 
Handle>>  &
(>>& ' 
RemoveCommentCommand>>' ;
request>>< C
,>>C D
CancellationToken>>E V
cancellationToken>>W h
)>>h i
{?? 	
var@@ 
commentEntity@@ 
=@@ 
_unitOfWork@@  +
.@@+ ,
CommentRepository@@, =
.@@= >
Get@@> A
(@@A B
filterAA 
:AA 
xAA 
=>AA 
xAA 
.AA 
IdAA !
==AA" $
requestAA% ,
.AA, -
DtoAA- 0
.AA0 1
	CommentIdAA1 :
,AA: ;
includePropertiesBB !
:BB! "
$"BB# %
{BB% &
nameofBB& ,
(BB, -
CommentBB- 4
.BB4 5
CommentedCaffBB5 B
)BBB C
}BBC D
$strBBD E
{BBE F
nameofBBF L
(BBL M
CaffBBM Q
.BBQ R
UploaderBBR Z
)BBZ [
}BB[ \
"BB\ ]
)BB] ^
.BB^ _
FirstOrDefaultBB_ m
(BBm n
)BBn o
;BBo p
ifCC 
(CC 
commentEntityCC 
==CC  
nullCC! %
)CC% &
{DD 
throwEE 
newEE #
EntityNotFoundExceptionEE 1
(EE1 2
$strEE2 N
)EEN O
;EEO P
}FF 

_validatorHH 
=HH 
newHH 
AndConditionHH )
(HH) *
newII !
AvailabilityValidatorII )
(II) *
commentEntityII* 7
.II7 8
CommentedCaffII8 E
)IIE F
,IIF G
newJJ 
OrConditionJJ 
(JJ  
newKK 
AdminUserValidatorKK *
(KK* +
requestKK+ 2
.KK2 3
UserKK3 7
)KK7 8
,KK8 9
newLL 
UploaderValidatorLL )
(LL) *
commentEntityLL* 7
.LL7 8
CommentedCaffLL8 E
,LLE F
requestLLG N
.LLN O
UserLLO S
)LLS T
)MM 
)MM 
;MM 
ifNN 
(NN 
!NN 

_validatorNN 
.NN 
ValidateNN $
(NN$ %
)NN% &
)NN& '
{OO 
throwPP 
newPP $
ValidationErrorExceptionPP 2
(PP2 3
$strPP3 M
)PPM N
;PPN O
}QQ 
_unitOfWorkRR 
.RR 
CommentRepositoryRR )
.RR) *
DeleteRR* 0
(RR0 1
commentEntityRR1 >
)RR> ?
;RR? @
awaitSS 
_unitOfWorkSS 
.SS 
SaveSS "
(SS" #
)SS# $
;SS$ %
returnTT 
UnitTT 
.TT 
ValueTT 
;TT 
}UU 	
publicWW 
asyncWW 
TaskWW 
<WW 
UnitWW 
>WW 
HandleWW  &
(WW& '
PostCommentCommandWW' 9
requestWW: A
,WWA B
CancellationTokenWWC T
cancellationTokenWWU f
)WWf g
{XX 	
varYY 
userIdYY 
=YY 
GuidYY 
.YY 
ParseYY #
(YY# $
requestYY$ +
.YY+ ,
UserYY, 0
.YY0 1
GetUserIdFromJwtYY1 A
(YYA B
)YYB C
)YYC D
;YYD E
varZZ 
userZZ 
=ZZ 
_unitOfWorkZZ "
.ZZ" #
UserRepositoryZZ# 1
.ZZ1 2
GetZZ2 5
(ZZ5 6
xZZ6 7
=>ZZ8 :
xZZ; <
.ZZ< =
IdZZ= ?
==ZZ@ B
userIdZZC I
)ZZI J
.ZZJ K
FirstZZK P
(ZZP Q
)ZZQ R
;ZZR S
var[[ 
commentedCaff[[ 
=[[ 
_unitOfWork[[  +
.[[+ ,
CaffRepository[[, :
.[[: ;
Get[[; >
([[> ?
x[[? @
=>[[A C
x[[D E
.[[E F
Id[[F H
==[[I K
request[[L S
.[[S T
CaffId[[T Z
,[[Z [
includeProperties[[\ m
:[[m n
nameof[[o u
([[u v
Caff[[v z
.[[z {
Comments	[[{ É
)
[[É Ñ
)
[[Ñ Ö
.
[[Ö Ü
FirstOrDefault
[[Ü î
(
[[î ï
)
[[ï ñ
;
[[ñ ó
if\\ 
(\\ 
commentedCaff\\ 
==\\  
null\\! %
)\\% &
{]] 
throw^^ 
new^^ #
EntityNotFoundException^^ 1
(^^1 2
$str^^2 N
)^^N O
;^^O P
}__ 

_validator`` 
=`` 
new`` !
AvailabilityValidator`` 2
(``2 3
commentedCaff``3 @
)``@ A
;``A B
ifaa 
(aa 
!aa 

_validatoraa 
.aa 
Validateaa $
(aa$ %
)aa% &
)aa& '
{bb 
throwcc 
newcc $
ValidationErrorExceptioncc 2
(cc2 3
$strcc3 M
)ccM N
;ccN O
}dd 
varff 
commentff 
=ff 
newff 
Commentff %
{gg 
Texthh 
=hh 
requesthh 
.hh 
Dtohh "
.hh" #
Texthh# '
,hh' (
CommentedCaffii 
=ii 
commentedCaffii  -
,ii- .
	Commenterjj 
=jj 
userjj  
}kk 
;kk 
commentedCaffll 
.ll 
Commentsll "
.ll" #
Addll# &
(ll& '
commentll' .
)ll. /
;ll/ 0
_unitOfWorkmm 
.mm 
CaffRepositorymm &
.mm& '
Updatemm' -
(mm- .
commentedCaffmm. ;
)mm; <
;mm< =
awaitnn 
_unitOfWorknn 
.nn 
Savenn "
(nn" #
)nn# $
;nn$ %
returnoo 
Unitoo 
.oo 
Valueoo 
;oo 
}pp 	
publicrr 
asyncrr 
Taskrr 
<rr 
Guidrr 
>rr 
Handlerr  &
(rr& '
UploadCaffCommandrr' 8
requestrr9 @
,rr@ A
CancellationTokenrrB S
cancellationTokenrrT e
)rre f
{ss 	
vartt 
sanitizedFilenamett !
=tt" #
_fileRepositorytt$ 3
.tt3 4
SanitizeFilenamett4 D
(ttD E
requestttE L
.ttL M
DtottM P
.ttP Q
CaffttQ U
.ttU V
FileNamettV ^
)tt^ _
;tt_ `
varuu 
	extensionuu 
=uu 
Pathuu  
.uu  !
GetExtensionuu! -
(uu- .
sanitizedFilenameuu. ?
)uu? @
;uu@ A
ifvv 
(vv 
	extensionvv 
.vv 
ToLowervv !
(vv! "
)vv" #
!=vv$ &
$strvv' .
)vv. /
{ww 
throwxx 
newxx $
ValidationErrorExceptionxx 2
(xx2 3
$strxx3 Q
)xxQ R
;xxR S
}yy 
string{{ 
caffPath{{ 
={{ 
Path{{ "
.{{" #
ChangeExtension{{# 2
({{2 3
Path{{3 7
.{{7 8
Combine{{8 ?
({{? @!
_webshopConfiguration{{@ U
.{{U V%
GetStaticFilePhysicalPath{{V o
({{o p
){{p q
,{{q r!
_webshopConfiguration|| %
.||% & 
GetCaffsSubdirectory||& :
(||: ;
)||; <
,||< =
Path||> B
.||B C
GetRandomFileName||C T
(||T U
)||U V
)||V W
,||W X
$str||Y `
)||` a
;||a b
string~~ 
path~~ 
=~~ 
Path~~ 
.~~ 
GetDirectoryName~~ /
(~~/ 0
caffPath~~0 8
)~~8 9
!~~9 :
;~~: ;
if 
( 
! 
	Directory 
. 
Exists !
(! "
path" &
)& '
)' (
{
ÄÄ 
	Directory
ÅÅ 
.
ÅÅ 
CreateDirectory
ÅÅ )
(
ÅÅ) *
path
ÅÅ* .
)
ÅÅ. /
;
ÅÅ/ 0
}
ÇÇ 
using
ÑÑ 
(
ÑÑ 
var
ÑÑ 
stream
ÑÑ 
=
ÑÑ 
File
ÑÑ  $
.
ÑÑ$ %
Create
ÑÑ% +
(
ÑÑ+ ,
caffPath
ÑÑ, 4
)
ÑÑ4 5
)
ÑÑ5 6
{
ÖÖ 
await
ÜÜ 
request
ÜÜ 
.
ÜÜ 
Dto
ÜÜ !
.
ÜÜ! "
Caff
ÜÜ" &
.
ÜÜ& '
CopyToAsync
ÜÜ' 2
(
ÜÜ2 3
stream
ÜÜ3 9
,
ÜÜ9 :
cancellationToken
ÜÜ; L
)
ÜÜL M
;
ÜÜM N
}
áá 
int
ââ 
	ciffCount
ââ 
=
ââ 
$num
ââ 
;
ââ 
string
ää 
metaPath
ää 
=
ää 
$"
ää  
{
ää  !#
_webshopConfiguration
ää! 6
.
ää6 7'
GetStaticFilePhysicalPath
ää7 P
(
ääP Q
)
ääQ R
}
ääR S
$str
ääS U
{
ääU V#
_webshopConfiguration
ääV k
.
ääk l&
GetCaffMetaSubdirectoryääl É
(ääÉ Ñ
)ääÑ Ö
}ääÖ Ü
$strääÜ à
"ääà â
;ääâ ä
path
ãã 
=
ãã 
Path
ãã 
.
ãã 
GetDirectoryName
ãã (
(
ãã( )
metaPath
ãã) 1
)
ãã1 2
!
ãã2 3
;
ãã3 4
if
åå 
(
åå 
!
åå 
	Directory
åå 
.
åå 
Exists
åå !
(
åå! "
path
åå" &
)
åå& '
)
åå' (
{
çç 
	Directory
éé 
.
éé 
CreateDirectory
éé )
(
éé) *
path
éé* .
)
éé. /
;
éé/ 0
}
èè 
var
êê 
result
êê 
=
êê 
readCaff
êê !
(
êê! "
new
êê" %
StringBuilder
êê& 3
(
êê3 4
Path
êê4 8
.
êê8 9
GetDirectoryName
êê9 I
(
êêI J
caffPath
êêJ R
)
êêR S
)
êêS T
,
êêT U
new
êêV Y
StringBuilder
êêZ g
(
êêg h
Path
êêh l
.
êêl m*
GetFileNameWithoutExtensionêêm à
(êêà â
caffPathêêâ ë
)êêë í
)êêí ì
,êêì î
newêêï ò
StringBuilderêêô ¶
(êê¶ ß
metaPathêêß Ø
)êêØ ∞
,êê∞ ±
refêê≤ µ
	ciffCountêê∂ ø
)êêø ¿
;êê¿ ¡
if
ëë 
(
ëë 
result
ëë 
!=
ëë 
$num
ëë 
)
ëë 
{
íí 
File
ìì 
.
ìì 
Delete
ìì 
(
ìì 
caffPath
ìì $
)
ìì$ %
;
ìì% &
throw
îî 
new
îî &
ValidationErrorException
îî 2
(
îî2 3
$str
îî3 E
)
îîE F
;
îîF G
}
ïï 
var
óó 

caffEntity
óó 
=
óó 
_fileRepository
óó ,
.
óó, -
ReadMetadata
óó- 9
(
óó9 :
metaPath
óó: B
,
óóB C
Path
óóD H
.
óóH I)
GetFileNameWithoutExtension
óóI d
(
óód e
caffPath
óóe m
)
óóm n
,
óón o
	ciffCount
óóp y
)
óóy z
;
óóz {
for
òò 
(
òò 
int
òò 
i
òò 
=
òò 
$num
òò 
;
òò 
i
òò 
<
òò 
	ciffCount
òò  )
;
òò) *
i
òò+ ,
++
òò, .
)
òò. /
{
ôô 
var
öö 
ciffName
öö 
=
öö 
$"
öö !
{
öö! "
Path
öö" &
.
öö& ')
GetFileNameWithoutExtension
öö' B
(
ööB C
caffPath
ööC K
)
ööK L
}
ööL M
$str
ööM N
{
ööN O
i
ööO P
}
ööP Q
$str
ööQ U
"
ööU V
;
ööV W
var
õõ 
ciffSavedPath
õõ !
=
õõ" #
_fileRepository
õõ$ 3
.
õõ3 4
SaveFile
õõ4 <
(
õõ< =
Path
õõ= A
.
õõA B
Combine
õõB I
(
õõI J
metaPath
õõJ R
,
õõR S
ciffName
õõT \
)
õõ\ ]
,
õõ] ^
$str
õõ_ e
,
õõe f
$"
õõg i
$str
õõi k
{
õõk l$
_webshopConfigurationõõl Å
.õõÅ Ç%
GetImagesSubdirectoryõõÇ ó
(õõó ò
)õõò ô
}õõô ö
"õõö õ
)õõõ ú
;õõú ù

caffEntity
úú 
.
úú 
Ciffs
úú  
[
úú  !
i
úú! "
]
úú" #
.
úú# $
PhysicalPath
úú$ 0
=
úú1 2
ciffSavedPath
úú3 @
;
úú@ A

caffEntity
ùù 
.
ùù 
Ciffs
ùù  
[
ùù  !
i
ùù! "
]
ùù" #
.
ùù# $
DisplayPath
ùù$ /
=
ùù0 1
$"
ùù2 4
$str
ùù4 5
{
ùù5 6
Path
ùù6 :
.
ùù: ;
GetFileName
ùù; F
(
ùùF G
ciffSavedPath
ùùG T
)
ùùT U
}
ùùU V
"
ùùV W
;
ùùW X
}
ûû 
var
üü 
userId
üü 
=
üü 
Guid
üü 
.
üü 
Parse
üü #
(
üü# $
request
üü$ +
.
üü+ ,
User
üü, 0
.
üü0 1
GetUserIdFromJwt
üü1 A
(
üüA B
)
üüB C
)
üüC D
;
üüD E
var
†† 
user
†† 
=
†† 
_unitOfWork
†† "
.
††" #
UserRepository
††# 1
.
††1 2
GetByID
††2 9
(
††9 :
userId
††: @
)
††@ A
;
††A B

caffEntity
¢¢ 
.
¢¢ 
Price
¢¢ 
=
¢¢ 
$num
¢¢  
;
¢¢  !

caffEntity
££ 
.
££ 
Title
££ 
=
££ 
request
££ &
.
££& '
Dto
££' *
.
££* +
Title
££+ 0
;
££0 1

caffEntity
§§ 
.
§§ 
Description
§§ "
=
§§# $
request
§§% ,
.
§§, -
Dto
§§- 0
.
§§0 1
Description
§§1 <
;
§§< =

caffEntity
•• 
.
•• 
Uploader
•• 
=
••  !
user
••" &
;
••& '

caffEntity
¶¶ 
.
¶¶ 
PhysicalPath
¶¶ #
=
¶¶$ %
caffPath
¶¶& .
;
¶¶. /
_unitOfWork
ßß 
.
ßß 
CaffRepository
ßß &
.
ßß& '
Insert
ßß' -
(
ßß- .

caffEntity
ßß. 8
)
ßß8 9
;
ßß9 :
await
®® 
_unitOfWork
®® 
.
®® 
Save
®® "
(
®®" #
)
®®# $
;
®®$ %
return
©© 

caffEntity
©© 
.
©© 
Id
©©  
;
©©  !
}
™™ 	
public
¨¨ 
async
¨¨ 
Task
¨¨ 
<
¨¨ 
Unit
¨¨ 
>
¨¨ 
Handle
¨¨  &
(
¨¨& '
DeleteCaffCommand
¨¨' 8
request
¨¨9 @
,
¨¨@ A
CancellationToken
¨¨B S
cancellationToken
¨¨T e
)
¨¨e f
{
≠≠ 	
var
ÆÆ 

caffEntity
ÆÆ 
=
ÆÆ 
_unitOfWork
ÆÆ (
.
ÆÆ( )
CaffRepository
ÆÆ) 7
.
ÆÆ7 8
Get
ÆÆ8 ;
(
ÆÆ; <
filter
ØØ 
:
ØØ 
x
ØØ 
=>
ØØ 
x
ØØ 
.
ØØ 
Id
ØØ !
==
ØØ" $
request
ØØ% ,
.
ØØ, -
CaffId
ØØ- 3
,
ØØ3 4
includeProperties
∞∞ !
:
∞∞! "
string
∞∞# )
.
∞∞) *
Join
∞∞* .
(
∞∞. /
$char
∞∞/ 2
,
∞∞2 3
nameof
∞∞4 :
(
∞∞: ;
Caff
∞∞; ?
.
∞∞? @
Uploader
∞∞@ H
)
∞∞H I
,
∞∞I J
nameof
∞∞K Q
(
∞∞Q R
Caff
∞∞R V
.
∞∞V W
Ciffs
∞∞W \
)
∞∞\ ]
)
∞∞] ^
)
±± 
.
±± 
FirstOrDefault
±±  
(
±±  !
)
±±! "
;
±±" #
if
≥≥ 
(
≥≥ 

caffEntity
≥≥ 
==
≥≥ 
null
≥≥ "
)
≥≥" #
{
¥¥ 
throw
µµ 
new
µµ %
EntityNotFoundException
µµ 1
(
µµ1 2
$str
µµ2 N
)
µµN O
;
µµO P
}
∂∂ 

_validator
∏∏ 
=
∏∏ 
new
∏∏ 
AndCondition
∏∏ )
(
∏∏) *
new
ππ #
AvailabilityValidator
ππ )
(
ππ) *

caffEntity
ππ* 4
)
ππ4 5
,
ππ5 6
new
∫∫ 
OrCondition
∫∫ 
(
∫∫  
new
ªª  
AdminUserValidator
ªª *
(
ªª* +
request
ªª+ 2
.
ªª2 3
User
ªª3 7
)
ªª7 8
,
ªª8 9
new
ºº 
UploaderValidator
ºº )
(
ºº) *

caffEntity
ºº* 4
,
ºº4 5
request
ºº6 =
.
ºº= >
User
ºº> B
)
ººB C
)
ΩΩ 
)
ææ 
;
ææ 
if
øø 
(
øø 
!
øø 

_validator
øø 
.
øø 
Validate
øø $
(
øø$ %
)
øø% &
)
øø& '
{
¿¿ 
throw
¡¡ 
new
¡¡ &
ValidationErrorException
¡¡ 2
(
¡¡2 3
$str
¡¡3 M
)
¡¡M N
;
¡¡N O
}
¬¬ 
_unitOfWork
ƒƒ 
.
ƒƒ 
CaffRepository
ƒƒ &
.
ƒƒ& '
Delete
ƒƒ' -
(
ƒƒ- .

caffEntity
ƒƒ. 8
)
ƒƒ8 9
;
ƒƒ9 :
foreach
≈≈ 
(
≈≈ 
var
≈≈ 
ciff
≈≈ 
in
≈≈  

caffEntity
≈≈! +
.
≈≈+ ,
Ciffs
≈≈, 1
)
≈≈1 2
{
∆∆ 
_fileRepository
«« 
.
««  

DeleteFile
««  *
(
««* +
ciff
««+ /
.
««/ 0
PhysicalPath
««0 <
)
««< =
;
««= >
}
»» 
await
…… 
_unitOfWork
…… 
.
…… 
Save
…… "
(
……" #
)
……# $
;
……$ %
return
   
Unit
   
.
   
Value
   
;
   
}
ÀÀ 	
public
ÕÕ 
async
ÕÕ 
Task
ÕÕ 
<
ÕÕ 
Unit
ÕÕ 
>
ÕÕ 
Handle
ÕÕ  &
(
ÕÕ& '
BuyCaffCommand
ÕÕ' 5
request
ÕÕ6 =
,
ÕÕ= >
CancellationToken
ÕÕ? P
cancellationToken
ÕÕQ b
)
ÕÕb c
{
ŒŒ 	
var
œœ 
userId
œœ 
=
œœ 
Guid
œœ 
.
œœ 
Parse
œœ #
(
œœ# $
request
œœ$ +
.
œœ+ ,
User
œœ, 0
.
œœ0 1
GetUserIdFromJwt
œœ1 A
(
œœA B
)
œœB C
)
œœC D
;
œœD E
var
–– 

caffEntity
–– 
=
–– 
_unitOfWork
–– (
.
––( )
CaffRepository
––) 7
.
––7 8
Get
––8 ;
(
––; <
x
––< =
=>
––> @
x
––A B
.
––B C
Id
––C E
==
––F H
request
––I P
.
––P Q
CaffId
––Q W
,
––W X
includeProperties
––Y j
:
––j k
nameof
––l r
(
––r s
Caff
––s w
.
––w x
BoughtBy––x Ä
)––Ä Å
)––Å Ç
.––Ç É
FirstOrDefault––É ë
(––ë í
)––í ì
;––ì î
if
—— 
(
—— 

caffEntity
—— 
==
—— 
null
—— "
)
——" #
{
““ 
throw
”” 
new
”” %
EntityNotFoundException
”” 1
(
””1 2
$str
””2 N
)
””N O
;
””O P
}
‘‘ 

_validator
’’ 
=
’’ 
new
’’ #
AvailabilityValidator
’’ 2
(
’’2 3

caffEntity
’’3 =
)
’’= >
;
’’> ?
if
÷÷ 
(
÷÷ 
!
÷÷ 

_validator
÷÷ 
.
÷÷ 
Validate
÷÷ $
(
÷÷$ %
)
÷÷% &
)
÷÷& '
{
◊◊ 
throw
ÿÿ 
new
ÿÿ &
ValidationErrorException
ÿÿ 2
(
ÿÿ2 3
$str
ÿÿ3 K
)
ÿÿK L
;
ÿÿL M
}
ŸŸ 
var
⁄⁄ 
buyer
⁄⁄ 
=
⁄⁄ 
_unitOfWork
⁄⁄ #
.
⁄⁄# $
UserRepository
⁄⁄$ 2
.
⁄⁄2 3
GetByID
⁄⁄3 :
(
⁄⁄: ;
userId
⁄⁄; A
)
⁄⁄A B
;
⁄⁄B C

caffEntity
€€ 
.
€€ 
BoughtBy
€€ 
=
€€  !
buyer
€€" '
;
€€' (
_unitOfWork
‹‹ 
.
‹‹ 
CaffRepository
‹‹ &
.
‹‹& '
Update
‹‹' -
(
‹‹- .

caffEntity
‹‹. 8
)
‹‹8 9
;
‹‹9 :
await
›› 
_unitOfWork
›› 
.
›› 
Save
›› "
(
››" #
)
››# $
;
››$ %
return
ﬁﬁ 
Unit
ﬁﬁ 
.
ﬁﬁ 
Value
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 	
public
·· 
async
·· 
Task
·· 
<
·· 
Unit
·· 
>
·· 
Handle
··  &
(
··& '!
EditCaffDataCommand
··' :
request
··; B
,
··B C
CancellationToken
··D U
cancellationToken
··V g
)
··g h
{
‚‚ 	
var
„„ 

caffEntity
„„ 
=
„„ 
_unitOfWork
„„ (
.
„„( )
CaffRepository
„„) 7
.
„„7 8
Get
„„8 ;
(
„„; <
filter
„„< B
:
„„B C
x
„„D E
=>
„„F H
x
„„I J
.
„„J K
Id
„„K M
==
„„N P
request
„„Q X
.
„„X Y
CaffId
„„Y _
,
„„_ `
includeProperties
‰‰ !
:
‰‰! "
string
‰‰# )
.
‰‰) *
Join
‰‰* .
(
‰‰. /
$char
‰‰/ 2
,
‰‰2 3
nameof
‰‰4 :
(
‰‰: ;
Caff
‰‰; ?
.
‰‰? @
Uploader
‰‰@ H
)
‰‰H I
,
‰‰I J
nameof
‰‰K Q
(
‰‰Q R
Caff
‰‰R V
.
‰‰V W
BoughtBy
‰‰W _
)
‰‰_ `
)
‰‰` a
)
‰‰a b
.
‰‰b c
FirstOrDefault
‰‰c q
(
‰‰q r
)
‰‰r s
;
‰‰s t
if
ÂÂ 
(
ÂÂ 

caffEntity
ÂÂ 
==
ÂÂ 
null
ÂÂ "
)
ÂÂ" #
{
ÊÊ 
throw
ÁÁ 
new
ÁÁ %
EntityNotFoundException
ÁÁ 1
(
ÁÁ1 2
$str
ÁÁ2 G
)
ÁÁG H
;
ÁÁH I
}
ËË 

_validator
ÍÍ 
=
ÍÍ 
new
ÍÍ 
AndCondition
ÍÍ )
(
ÍÍ) *
new
ÎÎ #
AvailabilityValidator
ÎÎ )
(
ÎÎ) *

caffEntity
ÎÎ* 4
)
ÎÎ4 5
,
ÎÎ5 6
new
ÏÏ 
OrCondition
ÏÏ 
(
ÏÏ  
new
ÌÌ  
AdminUserValidator
ÌÌ *
(
ÌÌ* +
request
ÌÌ+ 2
.
ÌÌ2 3
User
ÌÌ3 7
)
ÌÌ7 8
,
ÌÌ8 9
new
ÓÓ 
UploaderValidator
ÓÓ )
(
ÓÓ) *

caffEntity
ÓÓ* 4
,
ÓÓ4 5
request
ÓÓ6 =
.
ÓÓ= >
User
ÓÓ> B
)
ÓÓB C
)
ÔÔ 
)
 
;
 
if
ÒÒ 
(
ÒÒ 
!
ÒÒ 

_validator
ÒÒ 
.
ÒÒ 
Validate
ÒÒ $
(
ÒÒ$ %
)
ÒÒ% &
)
ÒÒ& '
{
ÚÚ 
throw
ÛÛ 
new
ÛÛ &
ValidationErrorException
ÛÛ 2
(
ÛÛ2 3
$str
ÛÛ3 M
)
ÛÛM N
;
ÛÛN O
}
ÙÙ 
if
ıı 
(
ıı 
!
ıı 
string
ıı 
.
ıı 
IsNullOrEmpty
ıı %
(
ıı% &
request
ıı& -
.
ıı- .
Dto
ıı. 1
.
ıı1 2
Title
ıı2 7
)
ıı7 8
)
ıı8 9
{
ˆˆ 

caffEntity
˜˜ 
.
˜˜ 
Title
˜˜  
=
˜˜! "
request
˜˜# *
.
˜˜* +
Dto
˜˜+ .
.
˜˜. /
Title
˜˜/ 4
;
˜˜4 5
}
¯¯ 
if
˘˘ 
(
˘˘ 
!
˘˘ 
string
˘˘ 
.
˘˘ 
IsNullOrEmpty
˘˘ %
(
˘˘% &
request
˘˘& -
.
˘˘- .
Dto
˘˘. 1
.
˘˘1 2
Description
˘˘2 =
)
˘˘= >
)
˘˘> ?
{
˙˙ 

caffEntity
˚˚ 
.
˚˚ 
Description
˚˚ &
=
˚˚' (
request
˚˚) 0
.
˚˚0 1
Dto
˚˚1 4
.
˚˚4 5
Description
˚˚5 @
;
˚˚@ A
}
¸¸ 
_unitOfWork
˛˛ 
.
˛˛ 
CaffRepository
˛˛ &
.
˛˛& '
Update
˛˛' -
(
˛˛- .

caffEntity
˛˛. 8
)
˛˛8 9
;
˛˛9 :
await
ˇˇ 
_unitOfWork
ˇˇ 
.
ˇˇ 
Save
ˇˇ "
(
ˇˇ" #
)
ˇˇ# $
;
ˇˇ$ %
return
ÄÄ 
Unit
ÄÄ 
.
ÄÄ 
Value
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
}
ÇÇ 
}ÉÉ ¿o
|E:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\CaffQueryHandler.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
{ 
public 

class 
CaffQueryHandler !
:" #
IRequestHandler 
<  
GetCaffDownloadQuery ,
,, -
byte. 2
[2 3
]3 4
>4 5
,5 6
IRequestHandler 
< 
GetCaffDetailsQuery +
,+ , 
CaffDetailsViewModel- A
>A B
,B C
IRequestHandler 
< 
GetCaffListQuery (
,( )(
EnumerableWithTotalViewModel* F
<F G
CaffListViewModelG X
>X Y
>Y Z
,Z [
IRequestHandler 
< 
GetBoughtCaffsQuery +
,+ ,(
EnumerableWithTotalViewModel- I
<I J
CaffListViewModelJ [
>[ \
>\ ]
{ 
private 
readonly 
IUnitOfWork $
_unitOfWork% 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
private 

IValidator 
? 

_validator &
;& '
public!! 
CaffQueryHandler!! 
(!!  
IUnitOfWork!!  +

unitOfWork!!, 6
,!!6 7
IMapper!!8 ?
mapper!!@ F
)!!F G
{"" 	
_unitOfWork## 
=## 

unitOfWork## $
;##$ %
_mapper$$ 
=$$ 
mapper$$ 
;$$ 
}%% 	
public'' 
Task'' 
<''  
CaffDetailsViewModel'' (
>''( )
Handle''* 0
(''0 1
GetCaffDetailsQuery''1 D
request''E L
,''L M
CancellationToken''N _
cancellationToken''` q
)''q r
{(( 	
var)) 

caffEntity)) 
=)) 
_unitOfWork)) (
.))( )
CaffRepository))) 7
.))7 8
Get))8 ;
()); <
filter** 
:** 
x** 
=>** 
x** 
.** 
Id** !
==**" $
request**% ,
.**, -
CaffId**- 3
,**3 4
	transform++ 
:++ 
x++ 
=>++ 
x++  !
.++! "
AsNoTracking++" .
(++. /
)++/ 0
,++0 1
includeProperties,, !
:,,! "
string,,# )
.,,) *
Join,,* .
(,,. /
$char,,/ 2
,,,2 3
nameof,,4 :
(,,: ;
Caff,,; ?
.,,? @
Uploader,,@ H
),,H I
,,,I J
nameof,,K Q
(,,Q R
Caff,,R V
.,,V W
Ciffs,,W \
),,\ ]
,,,] ^
$",,_ a
{,,a b
nameof,,b h
(,,h i
Caff,,i m
.,,m n
Comments,,n v
),,v w
},,w x
$str,,x y
{,,y z
nameof	,,z Ä
(
,,Ä Å
Comment
,,Å à
.
,,à â
	Commenter
,,â í
)
,,í ì
}
,,ì î
"
,,î ï
,
,,ï ñ
nameof
,,ó ù
(
,,ù û
Caff
,,û ¢
.
,,¢ £
BoughtBy
,,£ ´
)
,,´ ¨
)
,,¨ ≠
)
,,≠ Æ
.-- 
FirstOrDefault-- 
(--  
)--  !
;--! "
if.. 
(.. 

caffEntity.. 
==.. 
null.. "
).." #
{// 
throw00 
new00 #
EntityNotFoundException00 1
(001 2
$str002 L
)00L M
;00M N
}11 

_validator33 
=33 
new33 
OrCondition33 (
(33( )
new44 !
AvailabilityValidator44 )
(44) *

caffEntity44* 4
)444 5
,445 6
new55 
OwnershipValidator55 &
(55& '

caffEntity55' 1
,551 2
request553 :
.55: ;
User55; ?
)55? @
)66 
;66 
if77 
(77 
!77 

_validator77 
.77 
Validate77 $
(77$ %
)77% &
)77& '
{88 
throw99 
new99 $
ValidationErrorException99 2
(992 3
$str993 M
)99M N
;99N O
}:: 
var<< 
caffViewModel<< 
=<< 
_mapper<<  '
.<<' (
Map<<( +
<<<+ , 
CaffDetailsViewModel<<, @
><<@ A
(<<A B

caffEntity<<B L
)<<L M
;<<M N
return== 
Task== 
.== 

FromResult== "
(==" #
caffViewModel==# 0
)==0 1
;==1 2
}>> 	
public@@ 
Task@@ 
<@@ (
EnumerableWithTotalViewModel@@ 0
<@@0 1
CaffListViewModel@@1 B
>@@B C
>@@C D
Handle@@E K
(@@K L
GetCaffListQuery@@L \
request@@] d
,@@d e
CancellationToken@@f w
cancellationToken	@@x â
)
@@â ä
{AA 	

ExpressionBB 
<BB 
FuncBB 
<BB 
CaffBB  
,BB  !
boolBB" &
>BB& '
>BB' (
filterBB) /
=BB0 1
xBB2 3
=>BB4 6
xBB7 8
.BB8 9
BoughtByBB9 A
==BBB D
nullBBE I
;BBI J
ifCC 
(CC 
!CC 
stringCC 
.CC 
IsNullOrEmptyCC %
(CC% &
requestCC& -
.CC- .
DtoCC. 1
.CC1 2
SearchCC2 8
)CC8 9
)CC9 :
{DD 
filterEE 
=EE 
xEE 
=>EE 
xEE 
.EE  
BoughtByEE  (
==EE) +
nullEE, 0
&&EE1 3
xEE4 5
.EE5 6
TitleEE6 ;
.EE; <
ContainsEE< D
(EED E
requestEEE L
.EEL M
DtoEEM P
.EEP Q
SearchEEQ W
)EEW X
;EEX Y
}FF 
varGG 
caffEntitiesGG 
=GG 
_unitOfWorkGG *
.GG* +
CaffRepositoryGG+ 9
.GG9 :
GetGG: =
(GG= >
filterHH 
:HH 
filterHH 
,HH 
	transformII 
:II 
xII 
=>II 
xII  !
.II! "
AsNoTrackingII" .
(II. /
)II/ 0
,II0 1
includePropertiesJJ !
:JJ! "
stringJJ# )
.JJ) *
JoinJJ* .
(JJ. /
$charJJ/ 2
,JJ2 3
nameofJJ4 :
(JJ: ;
CaffJJ; ?
.JJ? @
UploaderJJ@ H
)JJH I
,JJI J
nameofJJK Q
(JJQ R
CaffJJR V
.JJV W
CiffsJJW \
)JJ\ ]
)JJ] ^
)KK 
.KK 
ToListKK 
(KK 
)KK 
;KK 
varMM "
caffViewModelWithCountMM &
=MM' (
_mapperMM) 0
.MM0 1
MapMM1 4
<MM4 5(
EnumerableWithTotalViewModelMM5 Q
<MMQ R
CaffListViewModelMMR c
>MMc d
>MMd e
(MMe f
caffEntitiesMMf r
)MMr s
;MMs t"
caffViewModelWithCountNN "
.NN" #
ValuesNN# )
=NN* +"
caffViewModelWithCountNN, B
.NNB C
ValuesNNC I
.NNI J
SkipNNJ N
(NNN O
(NNO P
requestNNP W
.NNW X
DtoNNX [
.NN[ \
	PageCountNN\ e
-NNf g
$numNNh i
)NNi j
*NNk l
requestNNm t
.NNt u
DtoNNu x
.NNx y
PageSize	NNy Å
)
NNÅ Ç
.
NNÇ É
Take
NNÉ á
(
NNá à
request
NNà è
.
NNè ê
Dto
NNê ì
.
NNì î
PageSize
NNî ú
)
NNú ù
;
NNù û
returnOO 
TaskOO 
.OO 

FromResultOO "
(OO" #"
caffViewModelWithCountOO# 9
)OO9 :
;OO: ;
}PP 	
publicRR 
TaskRR 
<RR (
EnumerableWithTotalViewModelRR 0
<RR0 1
CaffListViewModelRR1 B
>RRB C
>RRC D
HandleRRE K
(RRK L
GetBoughtCaffsQueryRRL _
requestRR` g
,RRg h
CancellationTokenRRi z
cancellationToken	RR{ å
)
RRå ç
{SS 	
varTT 
userIdTT 
=TT 
GuidTT 
.TT 
ParseTT #
(TT# $
requestTT$ +
.TT+ ,
UserTT, 0
.TT0 1
GetUserIdFromJwtTT1 A
(TTA B
)TTB C
)TTC D
;TTD E
varUU 

userEntityUU 
=UU 
_unitOfWorkUU (
.UU( )
UserRepositoryUU) 7
.UU7 8
GetUU8 ;
(UU; <
filterVV 
:VV 
xVV 
=>VV 
xVV 
.VV 
IdVV !
==VV" $
userIdVV% +
,VV+ ,
	transformWW 
:WW 
xWW 
=>WW 
xWW  !
.WW! "
AsNoTrackingWW" .
(WW. /
)WW/ 0
,WW0 1
includePropertiesXX !
:XX! "
stringXX# )
.XX) *
JoinXX* .
(XX. /
$charXX/ 2
,XX2 3
$"XX4 6
{XX6 7
nameofXX7 =
(XX= >
ApplicationUserXX> M
.XXM N
BoughtCaffsXXN Y
)XXY Z
}XXZ [
$strXX[ \
{XX\ ]
nameofXX] c
(XXc d
CaffXXd h
.XXh i
CiffsXXi n
)XXn o
}XXo p
"XXp q
,XXq r
$"XXs u
{XXu v
nameofXXv |
(XX| }
ApplicationUser	XX} å
.
XXå ç
BoughtCaffs
XXç ò
)
XXò ô
}
XXô ö
$str
XXö õ
{
XXõ ú
nameof
XXú ¢
(
XX¢ £
Caff
XX£ ß
.
XXß ®
Uploader
XX® ∞
)
XX∞ ±
}
XX± ≤
"
XX≤ ≥
)
XX≥ ¥
)YY 
.YY 
FirstOrDefaultYY  
(YY  !
)YY! "
;YY" #
ifZZ 
(ZZ 

userEntityZZ 
==ZZ 
nullZZ "
)ZZ" #
{[[ 
throw\\ 
new\\ #
EntityNotFoundException\\ 1
(\\1 2
$str\\2 L
)\\L M
;\\M N
}]] 
var^^ "
caffViewModelWithCount^^ &
=^^' (
_mapper^^) 0
.^^0 1
Map^^1 4
<^^4 5(
EnumerableWithTotalViewModel^^5 Q
<^^Q R
CaffListViewModel^^R c
>^^c d
>^^d e
(^^e f

userEntity^^f p
.^^p q
BoughtCaffs^^q |
)^^| }
;^^} ~"
caffViewModelWithCount__ "
.__" #
Values__# )
=__* +"
caffViewModelWithCount__, B
.__B C
Values__C I
.__I J
Skip__J N
(__N O
(__O P
request__P W
.__W X
Dto__X [
.__[ \
	PageCount__\ e
-__f g
$num__h i
)__i j
*__k l
request__m t
.__t u
Dto__u x
.__x y
PageSize	__y Å
)
__Å Ç
.
__Ç É
Take
__É á
(
__á à
request
__à è
.
__è ê
Dto
__ê ì
.
__ì î
PageSize
__î ú
)
__ú ù
;
__ù û
return`` 
Task`` 
.`` 

FromResult`` "
(``" #"
caffViewModelWithCount``# 9
)``9 :
;``: ;
}aa 	
publiccc 
asynccc 
Taskcc 
<cc 
bytecc 
[cc 
]cc  
>cc  !
Handlecc" (
(cc( ) 
GetCaffDownloadQuerycc) =
requestcc> E
,ccE F
CancellationTokenccG X
cancellationTokenccY j
)ccj k
{dd 	
varee 

caffEntityee 
=ee 
_unitOfWorkee (
.ee( )
CaffRepositoryee) 7
.ee7 8
Getee8 ;
(ee; <
filterff 
:ff 
xff 
=>ff 
xff 
.ff 
Idff !
==ff" $
requestff% ,
.ff, -
CaffIdff- 3
,ff3 4
	transformgg 
:gg 
xgg 
=>gg 
xgg  !
.gg! "
AsNoTrackinggg" .
(gg. /
)gg/ 0
,gg0 1
includePropertieshh !
:hh! "
nameofhh# )
(hh) *
Caffhh* .
.hh. /
BoughtByhh/ 7
)hh7 8
)ii 
.ii 
FirstOrDefaultii  
(ii  !
)ii! "
;ii" #
ifjj 
(jj 

caffEntityjj 
==jj 
nulljj "
)jj" #
{kk 
throwll 
newll #
EntityNotFoundExceptionll 1
(ll1 2
$strll2 Q
)llQ R
;llR S
}mm 

_validatoroo 
=oo 
newoo 
OwnershipValidatoroo /
(oo/ 0

caffEntityoo0 :
,oo: ;
requestoo< C
.ooC D
UserooD H
)ooH I
;ooI J
ifpp 
(pp 
!pp 

_validatorpp 
.pp 
Validatepp $
(pp$ %
)pp% &
)pp& '
{qq 
throwrr 
newrr $
ValidationErrorExceptionrr 2
(rr2 3
$strrr3 M
)rrM N
;rrN O
}ss 
returnuu 
awaituu 
Fileuu 
.uu 
ReadAllBytesAsyncuu /
(uu/ 0

caffEntityuu0 :
.uu: ;
PhysicalPathuu; G
,uuG H
cancellationTokenuuI Z
)uuZ [
;uu[ \
}vv 	
}ww 
}xx Å	
ÉE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Commands\BuyCaffCommand.cs
	namespace		 	
Webshop		
 
.		 
BLL		 
.		 
Infrastructure		 $
.		$ %
Commands		% -
{

 
public 

class 
BuyCaffCommand 
:  !
IRequest" *
<* +
Unit+ /
>/ 0
{ 
public 
Guid 
CaffId 
{ 
get  
;  !
set" %
;% &
}' (
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
BuyCaffCommand 
( 
Guid "
caffId# )
,) *
ClaimsPrincipal+ :
user; ?
)? @
{ 	
CaffId 
= 
caffId 
; 
User 
= 
user 
; 
} 	
} 
} Û
ÜE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Commands\CreateUserCommand.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Commands% -
{ 
public 

class 
CreateUserCommand "
:# $
IRequest% -
<- .
bool. 2
>2 3
{ 
public 
RegisterUserDto 
DTO "
{# $
get% (
;( )
set* -
;- .
}/ 0
public

 
CreateUserCommand

  
(

  !
RegisterUserDto

! 0
dto

1 4
)

4 5
{ 	
DTO 
= 
dto 
; 
} 	
} 
} ä	
ÜE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Commands\DeleteCaffCommand.cs
	namespace

 	
Webshop


 
.

 
BLL

 
.

 
Infrastructure

 $
.

$ %
Commands

% -
{ 
public 

class 
DeleteCaffCommand "
:# $
IRequest% -
<- .
Unit. 2
>2 3
{ 
public 
Guid 
CaffId 
{ 
get  
;  !
set" %
;% &
}' (
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DeleteCaffCommand  
(  !
Guid! %
caffId& ,
,, -
ClaimsPrincipal. =
user> B
)B C
{ 	
CaffId 
= 
caffId 
; 
User 
= 
user 
; 
} 	
} 
} •
àE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Commands\EditCaffDataCommand.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Commands% -
{ 
public 

class 
EditCaffDataCommand $
:% &
IRequest' /
</ 0
Unit0 4
>4 5
{ 
public 
Guid 
CaffId 
{ 
get  
;  !
set" %
;% &
}' (
public 
EditCaffDto 
Dto 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
EditCaffDataCommand "
(" #
Guid# '
caffId( .
,. /
EditCaffDto0 ;
dto< ?
,? @
ClaimsPrincipalA P
userQ U
)U V
{ 	
CaffId 
= 
caffId 
; 
Dto 
= 
dto 
; 
User 
= 
user 
; 
} 	
} 
} Â
ÑE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Commands\EditUserCommand.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Commands% -
{ 
public 

class 
EditUserCommand  
:! "
IRequest# +
<+ ,
bool, 0
>0 1
{ 
public 
EditUserDto 
DTO 
{  
get! $
;$ %
set& )
;) *
}+ ,
public

 
EditUserCommand

 
(

 
EditUserDto

 *
dto

+ .
)

. /
{ 	
DTO 
= 
dto 
; 
} 	
} 
} …
àE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Commands\EditUserRoleCommand.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Commands% -
{ 
public 

class 
EditUserRoleCommand $
:% &
IRequest' /
{ 
public 
EditUserRoleDto 
DTO "
{# $
get% (
;( )
set* -
;- .
}/ 0
public

 
EditUserRoleCommand

 "
(

" #
EditUserRoleDto

# 2
dto

3 6
)

6 7
{ 	
DTO 
= 
dto 
; 
} 	
} 
} ®
áE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Commands\PostCommentCommand.cs
	namespace

 	
Webshop


 
.

 
BLL

 
.

 
Infrastructure

 $
.

$ %
Commands

% -
{ 
public 

class 
PostCommentCommand #
:$ %
IRequest& .
<. /
Unit/ 3
>3 4
{ 
public 
Guid 
CaffId 
{ 
get  
;  !
set" %
;% &
}' (
public 
PostCommentDto 
Dto !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
PostCommentCommand !
(! "
Guid" &
caffId' -
,- .
ClaimsPrincipal/ >
user? C
,C D
PostCommentDtoE S
dtoT W
)W X
{ 	
CaffId 
= 
caffId 
; 
User 
= 
user 
; 
Dto 
= 
dto 
; 
} 	
} 
} ≤
âE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Commands\RemoveCommentCommand.cs
	namespace

 	
Webshop


 
.

 
BLL

 
.

 
Infrastructure

 $
.

$ %
Commands

% -
{ 
public 

class  
RemoveCommentCommand %
:& '
IRequest( 0
<0 1
Unit1 5
>5 6
{ 
public 
Guid 
CaffId 
{ 
get  
;  !
set" %
;% &
}' (
public 
RemoveCommentDto 
Dto  #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public  
RemoveCommentCommand #
(# $
Guid$ (
caffId) /
,/ 0
ClaimsPrincipal1 @
userA E
,E F
RemoveCommentDtoG W
dtoX [
)[ \
{ 	
CaffId 
= 
caffId 
; 
User 
= 
user 
; 
Dto 
= 
dto 
; 
} 	
} 
} ê	
ÜE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Commands\UploadCaffCommand.cs
	namespace

 	
Webshop


 
.

 
BLL

 
.

 
Infrastructure

 $
.

$ %
Commands

% -
{ 
public 

class 
UploadCaffCommand "
:# $
IRequest% -
<- .
Guid. 2
>2 3
{ 
public 
UploadCaffDto 
Dto  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
UploadCaffCommand  
(  !
UploadCaffDto! .
dto/ 2
,2 3
ClaimsPrincipal4 C
userD H
)H I
{ 	
Dto 
= 
dto 
; 
User 
= 
user 
; 
} 	
} 
} Å
ãE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\DataTransferObjects\EditCaffDto.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
DataTransferObjects% 8
{ 
public		 

class		 
EditCaffDto		 
{

 
public 
string 
? 
Title 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
? 
Description "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} ¸
ãE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\DataTransferObjects\EditUserDto.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
DataTransferObjects% 8
{ 
public 

class 
EditUserDto 
{ 
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
} 
}		 ≥
èE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\DataTransferObjects\EditUserRoleDto.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
DataTransferObjects% 8
{ 
public 

class 
EditUserRoleDto  
{ 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} á
ãE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\DataTransferObjects\GetCaffsDto.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
DataTransferObjects% 8
{ 
public		 

class		 
GetCaffsDto		 
{

 
public 
string 
? 
Search 
{ 
get  #
;# $
set% (
;( )
}* +
public 
int 
PageSize 
{ 
get !
;! "
set# &
;& '
}( )
public 
int 
	PageCount 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ù
éE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\DataTransferObjects\PostCommentDto.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
DataTransferObjects% 8
{ 
public		 

class		 
PostCommentDto		 
{

 
public 
string 
Text 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} ⁄
èE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\DataTransferObjects\RegisterUserDto.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
DataTransferObjects% 8
{ 
public 

class 
RegisterUserDto  
{ 
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public		 
string		 
Password		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
=		- .
string		/ 5
.		5 6
Empty		6 ;
;		; <
public

 
string

 
ConfirmedPassword

 '
{

( )
get

* -
;

- .
set

/ 2
;

2 3
}

4 5
=

6 7
string

8 >
.

> ?
Empty

? D
;

D E
} 
} –
êE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\DataTransferObjects\RemoveCommentDto.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
DataTransferObjects% 8
{ 
public		 

class		 
RemoveCommentDto		 !
{

 
public 
Guid 
	CommentId 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ù
éE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\DataTransferObjects\SearchCaffsDto.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
DataTransferObjects% 8
{ 
public		 

class		 
SearchCaffsDto		 
{

 
public 
string 
Term 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} ™
çE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\DataTransferObjects\UploadCaffDto.cs
	namespace		 	
Webshop		
 
.		 
BLL		 
.		 
Infrastructure		 $
.		$ %
DataTransferObjects		% 8
{

 
public 

class 
UploadCaffDto 
{ 
public 
string 
Title 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
string2 8
.8 9
Empty9 >
;> ?
public 
	IFormFile 
Caff 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ¸
àE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Queries\GetActualUserIdQuery.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Queries% ,
{ 
public 

class  
GetActualUserIdQuery %
:& '
IRequest( 0
<0 1
string1 7
>7 8
{ 
} 
} Â	
áE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Queries\GetBoughtCaffsQuery.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Queries% ,
{ 
public 

class 
GetBoughtCaffsQuery $
:% &
IRequest' /
</ 0(
EnumerableWithTotalViewModel0 L
<L M
CaffListViewModelM ^
>^ _
>_ `
{ 
public 
GetCaffsDto 
Dto 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
GetBoughtCaffsQuery "
(" #
GetCaffsDto# .
dto/ 2
,2 3
ClaimsPrincipal4 C
userD H
)H I
{ 	
Dto 
= 
dto 
; 
User 
= 
user 
; 
} 	
} 
} û	
áE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Queries\GetCaffDetailsQuery.cs
	namespace

 	
Webshop


 
.

 
BLL

 
.

 
Infrastructure

 $
.

$ %
Queries

% ,
{ 
public 

class 
GetCaffDetailsQuery $
:% &
IRequest' /
</ 0 
CaffDetailsViewModel0 D
>D E
{ 
public 
Guid 
CaffId 
{ 
get  
;  !
set" %
;% &
}' (
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
GetCaffDetailsQuery "
(" #
Guid# '
caffId( .
,. /
ClaimsPrincipal0 ?
user@ D
)D E
{ 	
CaffId 
= 
caffId 
; 
User 
= 
user 
; 
} 	
} 
} Ø	
àE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Queries\GetCaffDownloadQuery.cs
	namespace		 	
Webshop		
 
.		 
BLL		 
.		 
Infrastructure		 $
.		$ %
Queries		% ,
{

 
public 

class  
GetCaffDownloadQuery %
:& '
IRequest( 0
<0 1
byte1 5
[5 6
]6 7
>7 8
{ 
public 
Guid 
CaffId 
{ 
get  
;  !
set" %
;% &
}' (
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public  
GetCaffDownloadQuery #
(# $
Guid$ (
caffId) /
,/ 0
ClaimsPrincipal1 @
userA E
)E F
{ 	
CaffId 
= 
caffId 
; 
User 
= 
user 
; 
} 	
} 
} ‹	
ÑE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Queries\GetCaffListQuery.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Queries% ,
{ 
public 

class 
GetCaffListQuery !
:" #
IRequest$ ,
<, -(
EnumerableWithTotalViewModel- I
<I J
CaffListViewModelJ [
>[ \
>\ ]
{ 
public 
GetCaffsDto 
Dto 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
ClaimsPrincipal 
User #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
GetCaffListQuery 
(  
GetCaffsDto  +
dto, /
,/ 0
ClaimsPrincipal1 @
userA E
)E F
{ 	
Dto 
= 
dto 
; 
User 
= 
user 
; 
} 	
} 
} å
áE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Queries\GetFullProfileQuery.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Queries% ,
{ 
public 

class 
GetFullProfileQuery $
:% &
IRequest' /
</ 0$
ProfileWithNameViewModel0 H
>H I
{ 
} 
}		 ¸
ÉE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Queries\GetProfileQuery.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Queries% ,
{ 
public 

class 
GetProfileQuery  
:! "
IRequest# +
<+ ,
ProfileViewModel, <
>< =
{ 
} 
}		 ˛
ÄE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Queries\GetUserQuery.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Queries% ,
{ 
public 

class 
GetUserQuery 
: 
IRequest  (
<( )$
ProfileWithNameViewModel) A
>A B
{ 
public 
string 
? 
Id 
{ 
get 
;  
set! $
;$ %
}& '
public

 
GetUserQuery

 
(

 
string

 "
?

" #
id

$ &
)

& '
{ 	
Id 
= 
id 
; 
} 	
} 
} ≠
áE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\Queries\GetUsersByRoleQuery.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %
Queries% ,
{ 
public 

class 
GetUsersByRoleQuery $
:% &
IRequest' /
</ 0
IEnumerable0 ;
<; <
UserNameViewModel< M
>M N
>N O
{ 
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
public

 
GetUsersByRoleQuery

 "
(

" #
string

# )
role

* .
)

. /
{ 	
Role 
= 
role 
; 
} 	
} 
} ¥<
~E:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\UserCommandHandler.cs
	namespace

 	
Webshop


 
.

 
BLL

 
.

 
Infrastructure

 $
{ 
public 

class 
UserCommandHandler #
:$ %
IRequestHandler 
< 
CreateUserCommand )
,) *
bool+ /
>/ 0
,0 1
IRequestHandler 
< 
EditUserCommand '
,' (
bool) -
>- .
,. /
IRequestHandler 
< 
EditUserRoleCommand +
,+ ,
Unit- 1
>1 2
{ 
private 
readonly 

IUserStore #

_userStore$ .
;. /
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
RoleManager $
<$ %
ApplicationRole% 4
>4 5
_roleManager6 B
;B C
private 
readonly 
UserManager $
<$ %
ApplicationUser% 4
>4 5
_userManager6 B
;B C
public 
UserCommandHandler !
(! "
IMapper" )
mapper* 0
,0 1

IUserStore2 <
	userStore= F
,F G
RoleManagerH S
<S T
ApplicationRoleT c
>c d
roleManagere p
,p q
UserManager 
< 
ApplicationUser '
>' (
userManager) 4
)4 5
{ 	

_userStore 
= 
	userStore "
;" #
_mapper 
= 
mapper 
; 
_roleManager 
= 
roleManager &
;& '
_userManager 
= 
userManager &
;& '
} 	
public 
async 
Task 
< 
bool 
> 
Handle  &
(& '
CreateUserCommand' 8
request9 @
,@ A
CancellationTokenB S
cancellationTokenT e
)e f
{   	
if!! 
(!! 
request!! 
.!! 
DTO!! 
.!! 
Password!! $
!=!!% '
request!!( /
.!!/ 0
DTO!!0 3
.!!3 4
ConfirmedPassword!!4 E
)!!E F
{"" 
throw## 
new## %
InvalidParameterException## 3
(##3 4
$str##4 T
)##T U
;##U V
}$$ 
if%% 
(%% 
!%% 
RegexUtilities%% 
.%%  
IsValidEmail%%  ,
(%%, -
request%%- 4
.%%4 5
DTO%%5 8
.%%8 9
Email%%9 >
)%%> ?
)%%? @
{&& 
throw'' 
new'' %
InvalidParameterException'' 3
(''3 4
$str''4 T
)''T U
;''U V
}(( 
var** 
user** 
=** 
_mapper** 
.** 
Map** "
<**" #
ApplicationUser**# 2
>**2 3
(**3 4
request**4 ;
.**; <
DTO**< ?
)**? @
;**@ A
if++ 
(++ 
await++ 

_userStore++  
.++  !
IsUserTaken++! ,
(++, -
user++- 1
.++1 2
UserName++2 :
,++: ;
user++< @
.++@ A
Email++A F
,++F G
cancellationToken++H Y
)++Y Z
)++Z [
{,, 
throw-- 
new-- %
InvalidParameterException-- 3
(--3 4
$str--4 J
)--J K
;--K L
}.. 
bool00 
succeded00 
=00 
await00 !

_userStore00" ,
.00, -
CreateUserAsync00- <
(00< =
user00= A
,00A B
request00C J
.00J K
DTO00K N
.00N O
Password00O W
,00W X
cancellationToken00Y j
)00j k
;00k l
if11 
(11 
succeded11 
)11 
{22 
succeded33 
=33 
await33  

_userStore33! +
.33+ ,
AddRoleToUser33, 9
(339 :
user33: >
,33> ?
$str33@ I
,33I J
cancellationToken33K \
)33\ ]
;33] ^
}44 
return55 
succeded55 
;55 
}66 	
public88 
async88 
Task88 
<88 
bool88 
>88 
Handle88  &
(88& '
EditUserCommand88' 6
request887 >
,88> ?
CancellationToken88@ Q
cancellationToken88R c
)88c d
{99 	
var:: 
user:: 
=:: 
_mapper:: 
.:: 
Map:: "
<::" #
ApplicationUser::# 2
>::2 3
(::3 4
request::4 ;
.::; <
DTO::< ?
)::? @
;::@ A
if;; 
(;; 
await;; 

_userStore;;  
.;;  !
IsValidAsync;;! -
(;;- .
user;;. 2
,;;2 3
cancellationToken;;4 E
);;E F
);;F G
{<< 
throw== 
new== %
InvalidParameterException== 3
(==3 4
$str==4 J
)==J K
;==K L
}>> 
var?? 
userId?? 
=?? 
(?? 
await?? 

_userStore??  *
.??* +
GetActualUser??+ 8
(??8 9
cancellationToken??9 J
)??J K
)??K L
???L M
.??M N
Id??N P
??@@ 
throw@@ 
new@@ #
EntityNotFoundException@@ 4
(@@4 5
$str@@5 F
)@@F G
;@@G H
awaitAA 

_userStoreAA 
.AA !
UpdateActualUserAsyncAA 2
(AA2 3
userAA3 7
,AA7 8
userIdAA9 ?
,AA? @
cancellationTokenAAA R
)AAR S
;AAS T
returnBB 
trueBB 
;BB 
}CC 	
publicEE 
asyncEE 
TaskEE 
<EE 
UnitEE 
>EE 
HandleEE  &
(EE& '
EditUserRoleCommandEE' :
requestEE; B
,EEB C
CancellationTokenEED U
cancellationTokenEEV g
)EEg h
{FF 	
varGG 
domainGG 
=GG 
awaitGG 

_userStoreGG )
.GG) *
GetUserGG* 1
(GG1 2
requestGG2 9
.GG9 :
DTOGG: =
.GG= >
IdGG> @
.GG@ A
ToStringGGA I
(GGI J
)GGJ K
,GGK L
cancellationTokenGGM ^
)GG^ _
;GG_ `
awaitHH 

_userStoreHH 
.HH 
DeleteRolesOfUserHH .
(HH. /
domainHH/ 5
,HH5 6
cancellationTokenHH7 H
)HHH I
;HHI J
awaitII 

_userStoreII 
.II 
AddRoleToUserII *
(II* +
domainII+ 1
,II1 2
requestII3 :
.II: ;
DTOII; >
.II> ?
RoleII? C
,IIC D
cancellationTokenIIE V
)IIV W
;IIW X
returnKK 
UnitKK 
.KK 
ValueKK 
;KK 
}LL 	
}MM 
}NN Î,
|E:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\UserQueryHandler.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
{ 
public		 

class		 
UserQueryHandler		 !
:		" #
IRequestHandler

 
<

 
GetUserQuery

 $
,

$ %$
ProfileWithNameViewModel

& >
>

> ?
,

? @
IRequestHandler 
< 
GetProfileQuery '
,' (
ProfileViewModel) 9
>9 :
,: ;
IRequestHandler 
< 
GetFullProfileQuery +
,+ ,$
ProfileWithNameViewModel- E
>E F
,F G
IRequestHandler 
<  
GetActualUserIdQuery ,
,, -
string. 4
?4 5
>5 6
,6 7
IRequestHandler 
< 
GetUsersByRoleQuery +
,+ ,
IEnumerable- 8
<8 9
UserNameViewModel9 J
>J K
>K L
{ 
private 
readonly 

IUserStore #

_userStore$ .
;. /
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UserQueryHandler 
(  
IMapper  '
mapper( .
,. /

IUserStore0 :
	userStore; D
)D E
{ 	

_userStore 
= 
	userStore "
;" #
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
< $
ProfileWithNameViewModel 2
>2 3
Handle4 :
(: ;
GetUserQuery; G
requestH O
,O P
CancellationTokenQ b
cancellationTokenc t
)t u
{ 	
var 
domain 
= 
request  
.  !
Id! #
!=$ &
null' +
?, -
await 

_userStore  
.  !
GetUser! (
(( )
request) 0
.0 1
Id1 3
,3 4
cancellationToken5 F
)F G
.G H
ConfigureAwaitH V
(V W
falseW \
)\ ]
:^ _
await 

_userStore  
.  !
GetActualUser! .
(. /
cancellationToken/ @
)@ A
;A B
return 
_mapper 
. 
Map 
< $
ProfileWithNameViewModel 7
>7 8
(8 9
domain9 ?
)? @
;@ A
}   	
public"" 
async"" 
Task"" 
<"" 
string""  
?""  !
>""! "
Handle""# )
("") * 
GetActualUserIdQuery""* >
request""? F
,""F G
CancellationToken""H Y
cancellationToken""Z k
)""k l
{## 	
return$$ 
($$ 
await$$ 

_userStore$$ $
.$$$ %
GetActualUser$$% 2
($$2 3
cancellationToken$$3 D
)$$D E
)$$E F
?$$F G
.$$G H
Id$$H J
.$$J K
ToString$$K S
($$S T
)$$T U
;$$U V
}%% 	
public'' 
async'' 
Task'' 
<'' 
ProfileViewModel'' *
>''* +
Handle'', 2
(''2 3
GetProfileQuery''3 B
request''C J
,''J K
CancellationToken''L ]
cancellationToken''^ o
)''o p
{(( 	
return)) 
_mapper)) 
.)) 
Map)) 
<)) 
ProfileViewModel)) /
>))/ 0
())0 1
await))1 6

_userStore))7 A
.))A B
GetActualUser))B O
())O P
cancellationToken))P a
)))a b
)))b c
;))c d
}** 	
public,, 
async,, 
Task,, 
<,, $
ProfileWithNameViewModel,, 2
>,,2 3
Handle,,4 :
(,,: ;
GetFullProfileQuery,,; N
request,,O V
,,,V W
CancellationToken,,X i
cancellationToken,,j {
),,{ |
{-- 	
return.. 
_mapper.. 
... 
Map.. 
<.. $
ProfileWithNameViewModel.. 7
>..7 8
(..8 9
await..9 >

_userStore..? I
...I J
GetActualUser..J W
(..W X
cancellationToken..X i
)..i j
)..j k
;..k l
}// 	
public11 
async11 
Task11 
<11 
IEnumerable11 %
<11% &
UserNameViewModel11& 7
>117 8
>118 9
Handle11: @
(11@ A
GetUsersByRoleQuery11A T
request11U \
,11\ ]
CancellationToken11^ o
cancellationToken	11p Å
)
11Å Ç
{22 	
return33 
_mapper33 
.33 
Map33 
<33 
IEnumerable33 *
<33* +
UserNameViewModel33+ <
>33< =
>33= >
(33> ?
await33? D

_userStore33E O
.33O P
GetUsersByRole33P ^
(33^ _
request33_ f
.33f g
Role33g k
,33k l
cancellationToken33m ~
)33~ 
)	33 Ä
;
33Ä Å
}44 	
}55 
}66 Ó
ãE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\ViewModels\CaffDetailsViewModel.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %

ViewModels% /
{ 
public		 

class		  
CaffDetailsViewModel		 %
{

 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
string 
Creator 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 
int 
Price 
{ 
get 
; 
set  #
;# $
}% &
public 
DateTime 
CreationDate $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
string 
Title 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
string2 8
.8 9
Empty9 >
;> ?
public 
IEnumerable 
< 
CiffViewModel (
>( )
Ciffs* /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
=> ?

Enumerable@ J
.J K
EmptyK P
<P Q
CiffViewModelQ ^
>^ _
(_ `
)` a
;a b
public 
IEnumerable 
< 
CommentViewModel +
>+ ,
Comments- 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
=D E

EnumerableF P
.P Q
EmptyQ V
<V W
CommentViewModelW g
>g h
(h i
)i j
;j k
public 
UserNameViewModel  
Uploader! )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
=8 9
new: =
UserNameViewModel> O
(O P
)P Q
;Q R
} 
} ø
àE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\ViewModels\CaffListViewModel.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %

ViewModels% /
{ 
public		 

class		 
CaffListViewModel		 "
{

 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
int 
Price 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Title 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
string 
CoverUrl 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
UserNameViewModel  
Uploader! )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
=8 9
new: =
UserNameViewModel> O
(O P
)P Q
;Q R
} 
} ¶
àE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\ViewModels\CiffListViewModel.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %

ViewModels% /
{ 
public		 

class		 
CiffViewModel		 
{

 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
IEnumerable 
< 
string !
>! "
Tags# '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
=6 7

Enumerable8 B
.B C
EmptyC H
<H I
stringI O
>O P
(P Q
)Q R
;R S
public 
string 
Caption 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 
int 
Duration 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 

DisplayUrl  
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
string1 7
.7 8
Empty8 =
;= >
} 
} ∑
áE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\ViewModels\CommentViewModel.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %

ViewModels% /
{ 
public		 

class		 
CommentViewModel		 !
{

 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
string 
Text 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 
UserNameViewModel  
	Commenter! *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
=9 :
new; >
UserNameViewModel? P
(P Q
)Q R
;R S
} 
} Ì
ìE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\ViewModels\EnumerableWithTotalViewModel.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %

ViewModels% /
{ 
public		 

class		 (
EnumerableWithTotalViewModel		 -
<		- .
T		. /
>		/ 0
{

 
public 
IEnumerable 
< 
T 
> 
Values $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4

Enumerable5 ?
.? @
Empty@ E
<E F
TF G
>G H
(H I
)I J
;J K
public 
int 
Total 
{ 
get 
; 
set  #
;# $
}% &
} 
} Ï
áE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\ViewModels\ProfileViewModel.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %

ViewModels% /
{ 
public 

class 
ProfileViewModel !
{ 
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
} 
}		 Ò

èE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\ViewModels\ProfileWithNameViewModel.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %

ViewModels% /
{ 
public 

class $
ProfileWithNameViewModel )
{ 
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
}		 
}

 ©
àE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Infrastructure\ViewModels\UserNameViewModel.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Infrastructure $
.$ %

ViewModels% /
{ 
public 

class 
UserNameViewModel "
{ 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
} 
} £=
xE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\MappingProfiles\CaffProfile.cs
	namespace 	
Webshop
 
. 
BLL 
. 
MappingProfiles %
{ 
public 

class 
CaffProfile 
: 
Profile &
{ 
public 
CaffProfile 
( 
) 
{ 	
	CreateMap 
< 
UploadCaffDto #
,# $
Caff% )
>) *
(* +
)+ ,
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Title( -
,- .
opt/ 2
=>3 5
opt6 9
.9 :
MapFrom: A
(A B
srcB E
=>F H
srcI L
.L M
TitleM R
)R S
)S T
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Description( 3
,3 4
opt5 8
=>9 ;
opt< ?
.? @
MapFrom@ G
(G H
srcH K
=>L N
srcO R
.R S
DescriptionS ^
)^ _
)_ `
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Price( -
,- .
opt/ 2
=>3 5
opt6 9
.9 :
MapFrom: A
(A B
xB C
=>D F
$numG H
)H I
)I J
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Uploader( 0
,0 1
opt2 5
=>6 8
opt9 <
.< =
Ignore= C
(C D
)D E
)E F
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Ciffs( -
,- .
opt/ 2
=>3 5
opt6 9
.9 :
Ignore: @
(@ A
)A B
)B C
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Creator( /
,/ 0
opt1 4
=>5 7
opt8 ;
.; <
Ignore< B
(B C
)C D
)D E
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
BoughtBy( 0
,0 1
opt2 5
=>6 8
opt9 <
.< =
Ignore= C
(C D
)D E
)E F
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
CreationDate( 4
,4 5
opt6 9
=>: <
opt= @
.@ A
IgnoreA G
(G H
)H I
)I J
;J K
	CreateMap 
< 
Caff 
, 
CaffListViewModel -
>- .
(. /
)/ 0
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Id( *
,* +
opt, /
=>0 2
opt3 6
.6 7
MapFrom7 >
(> ?
src? B
=>C E
srcF I
.I J
IdJ L
)L M
)M N
.   
	ForMember   
(   
dest   
=>    "
dest  # '
.  ' (
Price  ( -
,  - .
opt  / 2
=>  3 5
opt  6 9
.  9 :
MapFrom  : A
(  A B
src  B E
=>  F H
src  I L
.  L M
Price  M R
)  R S
)  S T
.!! 
	ForMember!! 
(!! 
dest!! 
=>!!  "
dest!!# '
.!!' (
Uploader!!( 0
,!!0 1
opt!!2 5
=>!!6 8
opt!!9 <
.!!< =
MapFrom!!= D
(!!D E
src!!E H
=>!!I K
src!!L O
.!!O P
Uploader!!P X
)!!X Y
)!!Y Z
."" 
	ForMember"" 
("" 
dest"" 
=>""  "
dest""# '
.""' (
Title""( -
,""- .
opt""/ 2
=>""3 5
opt""6 9
.""9 :
MapFrom"": A
(""A B
src""B E
=>""F H
src""I L
.""L M
Title""M R
)""R S
)""S T
.## 
	ForMember## 
(## 
dest## 
=>##  "
dest### '
.##' (
CoverUrl##( 0
,##0 1
opt##2 5
=>##6 8
opt##9 <
.##< =
ConvertUsing##= I
<##I J$
AlbumDisplayUrlConverter##J b
,##b c
Caff##d h
>##h i
(##i j
src##j m
=>##n p
src##q t
)##t u
)##u v
;##v w
	CreateMap%% 
<%% 
Caff%% 
,%%  
CaffDetailsViewModel%% 0
>%%0 1
(%%1 2
)%%2 3
;%%3 4
	CreateMap'' 
<'' 
Comment'' 
,'' 
CommentViewModel'' /
>''/ 0
(''0 1
)''1 2
;''2 3
	CreateMap)) 
<)) 
Ciff)) 
,)) 
CiffViewModel)) )
>))) *
())* +
)))+ ,
.** 
	ForMember** 
(** 
dest** 
=>**  "
dest**# '
.**' (
Id**( *
,*** +
opt**, /
=>**0 2
opt**3 6
.**6 7
MapFrom**7 >
(**> ?
src**? B
=>**C E
src**F I
.**I J
Id**J L
)**L M
)**M N
.++ 
	ForMember++ 
(++ 
dest++ 
=>++  "
dest++# '
.++' (

DisplayUrl++( 2
,++2 3
opt++4 7
=>++8 :
opt++; >
.++> ?
ConvertUsing++? K
<++K L&
PictureDisplayUrlConverter++L f
,++f g
Ciff++h l
>++l m
(++m n
src++n q
=>++r t
src++u x
)++x y
)++y z
.,, 
	ForMember,, 
(,, 
dest,, 
=>,,  "
dest,,# '
.,,' (
Duration,,( 0
,,,0 1
opt,,2 5
=>,,6 8
opt,,9 <
.,,< =
MapFrom,,= D
(,,D E
src,,E H
=>,,I K
src,,L O
.,,O P
Duration,,P X
),,X Y
),,Y Z
.-- 
	ForMember-- 
(-- 
dest-- 
=>--  "
dest--# '
.--' (
Tags--( ,
,--, -
opt--. 1
=>--2 4
opt--5 8
.--8 9
MapFrom--9 @
(--@ A
src--A D
=>--E G
src--H K
.--K L
Tags--L P
.--P Q
Split--Q V
(--V W
$char--W Z
,--Z [
StringSplitOptions--\ n
.--n o
TrimEntries--o z
)--z {
)--{ |
)--| }
... 
	ForMember.. 
(.. 
dest.. 
=>..  "
dest..# '
...' (
Caption..( /
,../ 0
opt..1 4
=>..5 7
opt..8 ;
...; <
MapFrom..< C
(..C D
src..D G
=>..H J
src..K N
...N O
Caption..O V
)..V W
)..W X
;..X Y
}// 	
}00 
}11 à
xE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\MappingProfiles\ListProfile.cs
	namespace

 	
Webshop


 
.

 
BLL

 
.

 
MappingProfiles

 %
{ 
public 

class 
ListProfile 
: 
Profile &
{ 
public 
ListProfile 
( 
) 
{ 	
	CreateMap 
( 
typeof 
( 
IEnumerable (
<( )
>) *
)* +
,+ ,
typeof- 3
(3 4(
EnumerableWithTotalViewModel4 P
<P Q
>Q R
)R S
)S T
.T U
ConvertUsingU a
(a b
typeofb h
(h i)
EnumerableWithTotalConverter	i Ö
<
Ö Ü
,
Ü á
>
á à
)
à â
)
â ä
;
ä ã
} 	
} 
} Ô.
xE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\MappingProfiles\UserProfile.cs
	namespace 	
Webshop
 
. 
BLL 
. 
MappingProfiles %
{ 
public 

class 
UserProfile 
: 
Profile &
{		 
public

 
UserProfile

 
(

 
)

 
{ 	
	CreateMap 
< 
ApplicationUser %
,% &
EditUserDto' 2
>2 3
(3 4
)4 5
.5 6

ReverseMap6 @
(@ A
)A B
;B C
	CreateMap 
< 
ApplicationUser %
,% &
EditUserRoleDto' 6
>6 7
(7 8
)8 9
.9 :

ReverseMap: D
(D E
)E F
;F G
	CreateMap 
< 
RegisterUserDto %
,% &
ApplicationUser' 6
>6 7
(7 8
)8 9
. 
	ForMember 
( 
u 
=> 
u  !
.! "
UserName" *
,* +
opt, /
=>0 2
opt3 6
.6 7
MapFrom7 >
(> ?
a? @
=>A C
aD E
.E F
UserNameF N
.N O
TrimO S
(S T
)T U
)U V
)V W
. 
	ForMember 
( 
u 
=> 
u  !
.! "
	FirstName" +
,+ ,
opt- 0
=>1 3
opt4 7
.7 8
MapFrom8 ?
(? @
a@ A
=>B D
aE F
.F G
	FirstNameG P
.P Q
TrimQ U
(U V
)V W
)W X
)X Y
. 
	ForMember 
( 
u 
=> 
u  !
.! "
LastName" *
,* +
opt, /
=>0 2
opt3 6
.6 7
MapFrom7 >
(> ?
a? @
=>A C
aD E
.E F
LastNameF N
.N O
TrimO S
(S T
)T U
)U V
)V W
. 
	ForMember 
( 
u 
=> 
u  !
.! "
Email" '
,' (
opt) ,
=>- /
opt0 3
.3 4
MapFrom4 ;
(; <
a< =
=>> @
aA B
.B C
EmailC H
.H I
TrimI M
(M N
)N O
)O P
)P Q
. 

ReverseMap 
( 
) 
; 
	CreateMap 
< 
ApplicationUser %
,% &
ProfileViewModel' 7
>7 8
(8 9
)9 :
. 
	ForMember 
( 
u 
=> 
u  !
.! "
Name" &
,& '
opt( +
=>, .
opt/ 2
.2 3
MapFrom3 :
(: ;
a; <
=>= ?
a@ A
.A B
GetFullNameB M
(M N
)N O
)O P
)P Q
. 

ReverseMap 
( 
) 
; 
	CreateMap 
< 
ApplicationUser %
,% &$
ProfileWithNameViewModel' ?
>? @
(@ A
)A B
. 

ReverseMap 
( 
) 
; 
	CreateMap 
< 
ApplicationUser %
,% &
UserNameViewModel' 8
>8 9
(9 :
): ;
. 

ReverseMap 
( 
) 
; 
	CreateMap 
< 
RegisterUserDto %
,% &
ApplicationUser' 6
>6 7
(7 8
)8 9
. 
	ForMember 
( 
u 
=> 
u  !
.! "
UserName" *
,* +
opt, /
=>0 2
opt3 6
.6 7
MapFrom7 >
(> ?
a? @
=>A C
aD E
.E F
UserNameF N
.N O
TrimO S
(S T
)T U
)U V
)V W
.   
	ForMember   
(   
u   
=>   
u    !
.  ! "
	FirstName  " +
,  + ,
opt  - 0
=>  1 3
opt  4 7
.  7 8
MapFrom  8 ?
(  ? @
a  @ A
=>  B D
a  E F
.  F G
	FirstName  G P
.  P Q
Trim  Q U
(  U V
)  V W
)  W X
)  X Y
.!! 
	ForMember!! 
(!! 
u!! 
=>!! 
u!!  !
.!!! "
LastName!!" *
,!!* +
opt!!, /
=>!!0 2
opt!!3 6
.!!6 7
MapFrom!!7 >
(!!> ?
a!!? @
=>!!A C
a!!D E
.!!E F
LastName!!F N
.!!N O
Trim!!O S
(!!S T
)!!T U
)!!U V
)!!V W
."" 
	ForMember"" 
("" 
u"" 
=>"" 
u""  !
.""! "
Email""" '
,""' (
opt"") ,
=>""- /
opt""0 3
.""3 4
MapFrom""4 ;
(""; <
a""< =
=>""> @
a""A B
.""B C
Email""C H
.""H I
Trim""I M
(""M N
)""N O
)""O P
)""P Q
.## 

ReverseMap## 
(## 
)## 
;## 
}$$ 	
}%% 
}&& ´Ç
}E:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Stores\Implementations\UserStore.cs
	namespace		 	
Webshop		
 
.		 
BLL		 
.		 
Stores		 
.		 
Implementations		 ,
{

 
public 

class 
	UserStore 
: 

IUserStore '
{ 
private 
readonly 
WebshopDbContext )

_dbContext* 4
;4 5
private 
readonly 
UserManager $
<$ %
ApplicationUser% 4
>4 5
_userManager6 B
;B C
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
public 
	UserStore 
( 
WebshopDbContext )
	dbContext* 3
,3 4
UserManager5 @
<@ A
ApplicationUserA P
>P Q
userManagerR ]
,] ^ 
IHttpContextAccessor_ s 
httpContextAccessor	t á
)
á à
{ 	

_dbContext 
= 
	dbContext "
;" #
_userManager 
= 
userManager &
;& ' 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7
} 	
public 
async 
Task 
< 
ApplicationUser )
>) *
GetUser+ 2
(2 3
string3 9
id: <
,< =
CancellationToken> O
cancellationTokenP a
)a b
{ 	
var 
user 
= 
await 

_dbContext '
.' (
Users( -
. 
AsNoTracking 
( 
) 
. 
FirstOrDefaultAsync $
($ %
u% &
=>' )
u* +
.+ ,
Id, .
==/ 1
Guid2 6
.6 7
Parse7 <
(< =
id= ?
)? @
)@ A
?? 
throw 
new #
EntityNotFoundException 4
(4 5
$str5 E
)E F
;F G
return 
user 
; 
} 	
public!! 
async!! 
Task!! 
<!! 
bool!! 
>!! 
IsUserTaken!!  +
(!!+ ,
string!!, 2
name!!3 7
,!!7 8
string!!9 ?
email!!@ E
,!!E F
CancellationToken!!G X
cancellationToken!!Y j
)!!j k
{"" 	
return## 
await## 

_dbContext## #
.### $
Users##$ )
.##) *
AsNoTracking##* 6
(##6 7
)##7 8
.##8 9
AnyAsync##9 A
(##A B
u##B C
=>##D F
u##G H
.##H I
UserName##I Q
==##R T
name##U Y
||##Z \
u##] ^
.##^ _
Email##_ d
==##e g
email##h m
,##m n
cancellationToken	##o Ä
)
##Ä Å
;
##Å Ç
}$$ 	
public&& 
async&& 
Task&& 
<&& 
bool&& 
>&& 
CreateUserAsync&&  /
(&&/ 0
ApplicationUser&&0 ?
user&&@ D
,&&D E
string&&F L
password&&M U
,&&U V
CancellationToken&&W h
cancellationToken&&i z
)&&z {
{'' 	
if(( 
((( 
await(( 
IsUserTaken(( !
(((! "
user((" &
.((& '
UserName((' /
,((/ 0
user((1 5
.((5 6
Email((6 ;
,((; <
cancellationToken((= N
)((N O
)((O P
{)) 
throw** 
new** %
InvalidParameterException** 3
(**3 4
$str**4 X
)**X Y
;**Y Z
}++ 
var-- 
result-- 
=-- 
await-- 
_userManager-- +
.--+ ,
CreateAsync--, 7
(--7 8
user--8 <
,--< =
password--> F
)--F G
;--G H
if// 
(// 
result// 
.// 
Errors// 
.// 
Any// !
(//! "
)//" #
)//# $
{00 
throw11 
new11 %
InvalidParameterException11 3
(113 4
string114 :
.11: ;
Join11; ?
(11? @
$char11@ D
,11D E
result11F L
.11L M
Errors11M S
.11S T
Select11T Z
(11Z [
e11[ \
=>11] _
e11` a
.11a b
Description11b m
)11m n
.11n o
ToList11o u
(11u v
)11v w
)11w x
)11x y
;11y z
}22 
return44 
result44 
.44 
	Succeeded44 #
;44# $
}55 	
public77 
async77 
Task77 
<77 
ApplicationUser77 )
?77) *
>77* +
GetActualUser77, 9
(779 :
CancellationToken77: K
cancellationToken77L ]
)77] ^
{88 	
var99 
userId99 
=99 
_userManager99 %
.99% &
	GetUserId99& /
(99/ 0 
_httpContextAccessor990 D
.99D E
HttpContext99E P
.99P Q
User99Q U
)99U V
;99V W
if:: 
(:: 
userId:: 
==:: 
null:: 
):: 
return::  &
null::' +
;::+ ,
return;; 
await;; 
GetUser;;  
(;;  !
userId;;! '
,;;' (
cancellationToken;;) :
);;: ;
;;;; <
}<< 	
public>> 
async>> 
Task>> 
DeleteUserAsync>> )
(>>) *
ApplicationUser>>* 9
user>>: >
,>>> ?
CancellationToken>>@ Q
cancellationToken>>R c
)>>c d
{?? 	
var@@ 
dUser@@ 
=@@ 
await@@ 
_userManager@@ *
.@@* +
FindByNameAsync@@+ :
(@@: ;
user@@; ?
.@@? @
UserName@@@ H
)@@H I
??@@J L
throw@@M R
new@@S V%
InvalidParameterException@@W p
(@@p q
$str	@@q Ç
)
@@Ç É
;
@@É Ñ
awaitAA 
_userManagerAA 
.AA 
DeleteAsyncAA *
(AA* +
dUserAA+ 0
)AA0 1
;AA1 2
}BB 	
publicDD 
asyncDD 
TaskDD 
<DD 
ApplicationRoleDD )
>DD) *
GetRoleDD+ 2
(DD2 3
stringDD3 9
nameDD: >
,DD> ?
CancellationTokenDD@ Q
cancellationTokenDDR c
)DDc d
{EE 	
returnFF 
awaitFF 

_dbContextFF #
.FF# $
RolesFF$ )
.GG 
AsNoTrackingGG 
(GG 
)GG 
.HH 
FirstOrDefaultAsyncHH $
(HH$ %
rHH% &
=>HH' )
rHH* +
.HH+ ,
NameHH, 0
==HH1 3
nameHH4 8
,HH8 9
cancellationTokenHH: K
)HHK L
??II 
throwII 
newII #
EntityNotFoundExceptionII 4
(II4 5
$strII5 E
)IIE F
;IIF G
}JJ 	
publicLL 
asyncLL 
TaskLL 
<LL 
boolLL 
>LL 
AddRoleToUserLL  -
(LL- .
ApplicationUserLL. =
userLL> B
,LLB C
stringLLD J
roleLLK O
,LLO P
CancellationTokenLLQ b
cancellationTokenLLc t
)LLt u
{MM 	
varNN 

roleDomainNN 
=NN 
awaitNN "
GetRoleNN# *
(NN* +
roleNN+ /
,NN/ 0
cancellationTokenNN1 B
)NNB C
;NNC D
varOO 
userRoleOO 
=OO 
newOO 
IdentityUserRoleOO /
<OO/ 0
GuidOO0 4
>OO4 5
{PP 
UserIdQQ 
=QQ 
userQQ 
.QQ 
IdQQ  
,QQ  !
RoleIdRR 
=RR 

roleDomainRR #
.RR# $
IdRR$ &
}SS 
;SS 
awaitTT 

_dbContextTT 
.TT 
	UserRolesTT &
.TT& '
AddAsyncTT' /
(TT/ 0
userRoleTT0 8
,TT8 9
cancellationTokenTT: K
)TTK L
;TTL M
awaitUU 

_dbContextUU 
.UU 
SaveChangesAsyncUU -
(UU- .
cancellationTokenUU. ?
)UU? @
;UU@ A
returnWW 
trueWW 
;WW 
}XX 	
publicZZ 
asyncZZ 
TaskZZ !
UpdateActualUserAsyncZZ /
(ZZ/ 0
ApplicationUserZZ0 ?
userZZ@ D
,ZZD E
GuidZZF J
userIdZZK Q
,ZZQ R
CancellationTokenZZS d
cancellationTokenZZe v
)ZZv w
{[[ 	
var\\ 
domain\\ 
=\\ 
await\\ 

_dbContext\\ )
.\\) *
Users\\* /
.\\/ 0
FirstOrDefaultAsync\\0 C
(\\C D
u\\D E
=>\\F H
u\\I J
.\\J K
Id\\K M
==\\N P
userId\\Q W
,\\W X
cancellationToken\\Y j
)\\j k
;\\k l
if]] 
(]] 
domain]] 
!=]] 
null]] 
)]] 
{^^ 
domain__ 
.__ 
	FirstName__  
=__! "
user__# '
.__' (
	FirstName__( 1
;__1 2
domain`` 
.`` 
LastName`` 
=``  !
user``" &
.``& '
LastName``' /
;``/ 0
domainaa 
.aa 
UserNameaa 
=aa  !
useraa" &
.aa& '
UserNameaa' /
;aa/ 0
}bb 
awaitcc 

_dbContextcc 
.cc 
SaveChangesAsynccc -
(cc- .
cancellationTokencc. ?
)cc? @
;cc@ A
}dd 	
publicff 
asyncff 
Taskff 
<ff 
boolff 
>ff 
IsValidAsyncff  ,
(ff, -
ApplicationUserff- <
userff= A
,ffA B
CancellationTokenffC T
cancellationTokenffU f
)fff g
{gg 	
varhh 
domainhh 
=hh 
awaithh 
GetActualUserhh ,
(hh, -
cancellationTokenhh- >
)hh> ?
;hh? @
returnii 
awaitii 

_dbContextii #
.ii# $
Usersii$ )
.jj 
AsNoTrackingjj 
(jj 
)jj 
.kk 
AnyAsynckk 
(kk 
ukk 
=>kk 
ukk  
.kk  !
Idkk! #
!=kk$ &
domainkk' -
.kk- .
Idkk. 0
&&kk1 3
(ll 
umm 
.mm 
Emailmm 
==mm 
usermm #
.mm# $
Emailmm$ )
||mm* ,
unn 
.nn 
UserNamenn 
==nn !
usernn" &
.nn& '
UserNamenn' /
)oo 
,oo 
cancellationTokenpp !
)pp! "
;pp" #
}qq 	
publicss 
asyncss 
Taskss 
<ss 
IEnumerabless %
<ss% &
ApplicationUserss& 5
>ss5 6
>ss6 7
GetUsersByRoless8 F
(ssF G
stringssG M
rolessN R
,ssR S
CancellationTokenssT e
cancellationTokenssf w
)ssw x
{tt 	
varuu 
roleIduu 
=uu 
(uu 
awaituu 
GetRoleuu  '
(uu' (
roleuu( ,
,uu, -
cancellationTokenuu. ?
)uu? @
)uu@ A
.uuA B
IduuB D
;uuD E
returnvv 
awaitvv 

_dbContextvv #
.vv# $
Usersvv$ )
.vv) *
AsNoTrackingvv* 6
(vv6 7
)vv7 8
.ww 
Includeww 
(ww 
uww 
=>ww 
uww 
.ww  
	UserRolesww  )
)ww) *
.xx 
Wherexx 
(xx 
uxx 
=>xx 
uxx 
.xx 
	UserRolesxx '
.xx' (
Anyxx( +
(xx+ ,
rxx, -
=>xx. 0
rxx1 2
.xx2 3
RoleIdxx3 9
==xx: <
roleIdxx= C
)xxC D
)xxD E
.yy 
ToListAsyncyy 
(yy 
cancellationTokenyy .
)yy. /
;yy/ 0
}zz 	
public|| 
async|| 
Task|| 
<|| 
bool|| 
>|| 
DeleteRolesOfUser||  1
(||1 2
ApplicationUser||2 A
user||B F
,||F G
CancellationToken||H Y
cancellationToken||Z k
)||k l
{}} 	
var~~ 
	userRoles~~ 
=~~ 
await~~ !

_dbContext~~" ,
.~~, -
	UserRoles~~- 6
. 
AsNoTracking 
( 
) 
.
ÄÄ 
Where
ÄÄ 
(
ÄÄ 
ur
ÄÄ 
=>
ÄÄ 
ur
ÄÄ 
.
ÄÄ  
UserId
ÄÄ  &
==
ÄÄ' )
user
ÄÄ* .
.
ÄÄ. /
Id
ÄÄ/ 1
)
ÄÄ1 2
.
ÅÅ 
ToListAsync
ÅÅ 
(
ÅÅ 
cancellationToken
ÅÅ .
)
ÅÅ. /
;
ÅÅ/ 0

_dbContext
ÉÉ 
.
ÉÉ 
	UserRoles
ÉÉ  
.
ÉÉ  !
RemoveRange
ÉÉ! ,
(
ÉÉ, -
	userRoles
ÉÉ- 6
)
ÉÉ6 7
;
ÉÉ7 8
await
ÑÑ 

_dbContext
ÑÑ 
.
ÑÑ 
SaveChangesAsync
ÑÑ -
(
ÑÑ- .
cancellationToken
ÑÑ. ?
)
ÑÑ? @
;
ÑÑ@ A
return
ÜÜ 
true
ÜÜ 
;
ÜÜ 
}
áá 	
public
ââ 
async
ââ 
Task
ââ 
<
ââ 
IEnumerable
ââ %
<
ââ% &
ApplicationRole
ââ& 5
>
ââ5 6
>
ââ6 7
GetOwnRoles
ââ8 C
(
ââC D
CancellationToken
ââD U
cancellationToken
ââV g
)
ââg h
{
ää 	
var
ãã 
user
ãã 
=
ãã 
await
ãã 
GetActualUser
ãã *
(
ãã* +
cancellationToken
ãã+ <
)
ãã< =
;
ãã= >
if
åå 
(
åå 
user
åå 
==
åå 
null
åå 
)
åå 
throw
åå #
new
åå$ '%
EntityNotFoundException
åå( ?
(
åå? @
$str
åå@ P
)
ååP Q
;
ååQ R
var
çç 
roleIds
çç 
=
çç 
(
çç 
await
çç  

_dbContext
çç! +
.
çç+ ,
	UserRoles
çç, 5
.
éé 
AsNoTracking
éé 
(
éé 
)
éé 
.
èè 
Where
èè 
(
èè 
ur
èè 
=>
èè 
ur
èè 
.
èè  
UserId
èè  &
==
èè' )
user
èè* .
.
èè. /
Id
èè/ 1
)
èè1 2
.
êê 
ToListAsync
êê 
(
êê 
cancellationToken
êê .
)
êê. /
)
êê/ 0
.
ëë 
Select
ëë 
(
ëë 
ur
ëë 
=>
ëë 
ur
ëë  
.
ëë  !
RoleId
ëë! '
)
ëë' (
;
ëë( )
return
íí 
await
íí 

_dbContext
íí #
.
íí# $
Roles
íí$ )
.
ìì 
AsNoTracking
ìì 
(
ìì 
)
ìì 
.
îî 
Where
îî 
(
îî 
r
îî 
=>
îî 
roleIds
îî #
.
îî# $
Contains
îî$ ,
(
îî, -
r
îî- .
.
îî. /
Id
îî/ 1
)
îî1 2
)
îî2 3
.
ïï 
ToListAsync
ïï 
(
ïï 
cancellationToken
ïï .
)
ïï. /
;
ïï/ 0
}
ññ 	
}
óó 
}òò ›
yE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Stores\Interfaces\IUserStore.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Stores 
. 

Interfaces '
{ 
public 

	interface 

IUserStore 
{ 
Task 
< 
bool 
> 
CreateUserAsync "
(" #
ApplicationUser# 2
user3 7
,7 8
string9 ?
password@ H
,H I
CancellationTokenJ [
cancellationToken\ m
)m n
;n o
Task 
DeleteUserAsync 
( 
ApplicationUser ,
user- 1
,1 2
CancellationToken3 D
cancellationTokenE V
)V W
;W X
Task		 
<		 
ApplicationUser		 
>		 
GetUser		 %
(		% &
string		& ,
id		- /
,		/ 0
CancellationToken		1 B
cancellationToken		C T
)		T U
;		U V
Task

 
<

 
IEnumerable

 
<

 
ApplicationUser

 (
>

( )
>

) *
GetUsersByRole

+ 9
(

9 :
string

: @
role

A E
,

E F
CancellationToken

G X
cancellationToken

Y j
)

j k
;

k l
Task 
< 
ApplicationRole 
> 
GetRole %
(% &
string& ,
name- 1
,1 2
CancellationToken3 D
cancellationTokenE V
)V W
;W X
Task 
< 
IEnumerable 
< 
ApplicationRole (
>( )
>) *
GetOwnRoles+ 6
(6 7
CancellationToken7 H
cancellationTokenI Z
)Z [
;[ \
Task 
< 
bool 
> 
AddRoleToUser  
(  !
ApplicationUser! 0
user1 5
,5 6
string7 =
role> B
,B C
CancellationTokenD U
cancellationTokenV g
)g h
;h i
Task 
< 
bool 
> 
DeleteRolesOfUser $
($ %
ApplicationUser% 4
user5 9
,9 :
CancellationToken; L
cancellationTokenM ^
)^ _
;_ `
Task 
< 
bool 
> 
IsUserTaken 
( 
string %
name& *
,* +
string, 2
email3 8
,8 9
CancellationToken: K
cancellationTokenL ]
)] ^
;^ _
Task 
< 
ApplicationUser 
? 
> 
GetActualUser ,
(, -
CancellationToken- >
cancellationToken? P
)P Q
;Q R
Task !
UpdateActualUserAsync "
(" #
ApplicationUser# 2
user3 7
,7 8
Guid9 =
userId> D
,D E
CancellationTokenF W
cancellationTokenX i
)i j
;j k
Task 
< 
bool 
> 
IsValidAsync 
(  
ApplicationUser  /
user0 4
,4 5
CancellationToken6 G
cancellationTokenH Y
)Y Z
;Z [
} 
} ÷
àE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\TypeConverters\EnumerableWithTotalConverter.cs
	namespace		 	
Webshop		
 
.		 
BLL		 
.		 
TypeConverters		 $
{

 
public 

class (
EnumerableWithTotalConverter -
<- .
TSource. 5
,5 6
TDest7 <
>< =
:> ?
ITypeConverter@ N
<N O
IEnumerableO Z
<Z [
TSource[ b
>b c
,c d)
EnumerableWithTotalViewModel	e Å
<
Å Ç
TDest
Ç á
>
á à
>
à â
{ 
public (
EnumerableWithTotalViewModel +
<+ ,
TDest, 1
>1 2
Convert3 :
(: ;
IEnumerable; F
<F G
TSourceG N
>N O
sourceP V
,V W(
EnumerableWithTotalViewModelX t
<t u
TDestu z
>z {
destination	| á
,
á à
ResolutionContext
â ö
context
õ ¢
)
¢ £
{ 	
var 

mappedList 
= 
context $
.$ %
Mapper% +
.+ ,
Map, /
</ 0
IEnumerable0 ;
<; <
TSource< C
>C D
,D E
IEnumerableF Q
<Q R
TDestR W
>W X
>X Y
(Y Z
sourceZ `
)` a
;a b
return 
new (
EnumerableWithTotalViewModel 3
<3 4
TDest4 9
>9 :
{ 
Values 
= 

mappedList #
,# $
Total 
= 
source 
. 
Count $
($ %
)% &
} 
; 
} 	
} 
} Ä
qE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Utils\RegexUtilities.cs
	namespace 	
Webshop
 
. 
BLL 
. 
Utils 
{ 
public 

static 
class 
RegexUtilities &
{ 
private		 
static		 
string		 
DomainMapper		 *
(		* +
Match		+ 0
match		1 6
)		6 7
{

 	
var 
idn 
= 
new 

IdnMapping $
($ %
)% &
;& '
string 

domainName 
= 
idn  #
.# $
GetAscii$ ,
(, -
match- 2
.2 3
Groups3 9
[9 :
$num: ;
]; <
.< =
Value= B
)B C
;C D
return 
match 
. 
Groups 
[  
$num  !
]! "
." #
Value# (
+) *

domainName+ 5
;5 6
} 	
public 
static 
bool 
IsValidEmail '
(' (
string( .
email/ 4
)4 5
{ 	
if 
( 
string 
. 
IsNullOrWhiteSpace )
() *
email* /
)/ 0
)0 1
{ 
return 
false 
; 
} 
try 
{ 
email 
= 
Regex 
. 
Replace %
(% &
email& +
,+ ,
$str- 8
,8 9
DomainMapper: F
,F G
RegexOptionsH T
.T U
NoneU Y
,Y Z
TimeSpan[ c
.c d
FromMillisecondsd t
(t u
$numu x
)x y
)y z
;z {
return 
Regex 
. 
IsMatch $
($ %
email 
, 
$str 8
,8 9
RegexOptions: F
.F G

IgnoreCaseG Q
,Q R
TimeSpanS [
.[ \
FromMilliseconds\ l
(l m
$numm p
)p q
)   
;   
}!! 
catch"" 
("" &
RegexMatchTimeoutException"" -
)""- .
{## 
return$$ 
false$$ 
;$$ 
}%% 
catch&& 
(&& 
ArgumentException&& $
)&&$ %
{'' 
return(( 
false(( 
;(( 
})) 
}** 	
}++ 
},, ∆
äE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Validators\Implementations\AdminUserValidator.cs
	namespace

 	
Webshop


 
.

 
BLL

 
.

 

Validators

  
.

  !
Implementations

! 0
{ 
public 

class 
AdminUserValidator #
:$ %

IValidator& 0
{ 
private 
readonly 
ClaimsPrincipal (
_user) .
;. /
public 
AdminUserValidator !
(! "
ClaimsPrincipal" 1
user2 6
)6 7
{ 	
_user 
= 
user 
; 
} 	
public 
bool 
Validate 
( 
) 
{ 	
return 
_user 
. 
IsInRole !
(! "
	RoleTypes" +
.+ ,
Admin, 1
)1 2
;2 3
} 	
} 
} ∞
ÑE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Validators\Implementations\AndCondition.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Validators  
.  !
Implementations! 0
{		 
public

 

class

 
AndCondition

 
:

 

IValidator

  *
{ 
private 
readonly 

IValidator #

validator1$ .
;. /
private 
readonly 

IValidator #

validator2$ .
;. /
public 
AndCondition 
( 

IValidator &

validator1' 1
,1 2

IValidator3 =

validator2> H
)H I
{ 	
this 
. 

validator1 
= 

validator1 (
;( )
this 
. 

validator2 
= 

validator2 (
;( )
} 	
public 
bool 
Validate 
( 
) 
{ 	
return 

validator1 
. 
Validate &
(& '
)' (
&&) +

validator2, 6
.6 7
Validate7 ?
(? @
)@ A
;A B
} 	
} 
} Ñ
çE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Validators\Implementations\AvailabilityValidator.cs
	namespace

 	
Webshop


 
.

 
BLL

 
.

 

Validators

  
.

  !
Implementations

! 0
{ 
public 

class !
AvailabilityValidator &
:' (

IValidator) 3
{ 
private 
readonly 
Caff 
_caff #
;# $
public !
AvailabilityValidator $
($ %
Caff% )
caff* .
). /
{ 	
_caff 
= 
caff 
; 
} 	
public 
bool 
Validate 
( 
) 
{ 	
return 
_caff 
. 
BoughtBy !
==" $
null% )
;) *
} 	
} 
} ∑
ÑE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Validators\Implementations\NotCondition.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Validators  
.  !
Implementations! 0
{		 
public

 

class

 
NotCondition

 
:

 

IValidator

  *
{ 
private 
readonly 

IValidator #
	validator$ -
;- .
public 
NotCondition 
( 

IValidator &
	validator' 0
)0 1
{ 	
this 
. 
	validator 
= 
	validator &
;& '
} 	
public 
bool 
Validate 
( 
) 
{ 	
return 
! 
	validator 
. 
Validate &
(& '
)' (
;( )
} 	
} 
} ≠
ÉE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Validators\Implementations\OrCondition.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Validators  
.  !
Implementations! 0
{		 
public

 

class

 
OrCondition

 
:

 

IValidator

 )
{ 
private 
readonly 

IValidator #

validator1$ .
;. /
private 
readonly 

IValidator #

validator2$ .
;. /
public 
OrCondition 
( 

IValidator %

validator1& 0
,0 1

IValidator2 <

validator2= G
)G H
{ 	
this 
. 

validator1 
= 

validator1 (
;( )
this 
. 

validator2 
= 

validator2 (
;( )
} 	
public 
bool 
Validate 
( 
) 
{ 	
return 

validator1 
. 
Validate &
(& '
)' (
||) +

validator2, 6
.6 7
Validate7 ?
(? @
)@ A
;A B
} 	
} 
} ˇ
äE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Validators\Implementations\OwnershipValidator.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Validators  
.  !
Implementations! 0
{ 
public 

class 
OwnershipValidator #
:$ %

IValidator& 0
{ 
private 
readonly 
Caff 
_caff #
;# $
private 
readonly 
ClaimsPrincipal (
_user) .
;. /
public 
OwnershipValidator !
(! "
Caff" &
caff' +
,+ ,
ClaimsPrincipal- <
user= A
)A B
{ 	
_caff 
= 
caff 
; 
_user 
= 
user 
; 
} 	
public 
bool 
Validate 
( 
) 
{ 	
if 
( 
_caff 
. 
BoughtBy 
== !
null" &
)& '
{ 
return 
false 
; 
} 
return 
_caff 
. 
BoughtBy !
.! "
Id" $
==% '
Guid( ,
., -
Parse- 2
(2 3
_user3 8
.8 9
GetUserIdFromJwt9 I
(I J
)J K
)K L
;L M
}   	
}!! 
}"" †
âE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Validators\Implementations\UploaderValidator.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Validators  
.  !
Implementations! 0
{ 
public 

class 
UploaderValidator "
:# $

IValidator% /
{ 
private 
readonly 
Caff 
_caff #
;# $
private 
readonly 
ClaimsPrincipal (
_user) .
;. /
public 
UploaderValidator  
(  !
Caff! %
caff& *
,* +
ClaimsPrincipal, ;
user< @
)@ A
{ 	
_caff 
= 
caff 
; 
_user 
= 
user 
; 
} 	
public 
bool 
Validate 
( 
) 
{ 	
return 
_caff 
. 
Uploader !
.! "
Id" $
==% '
Guid( ,
., -
Parse- 2
(2 3
_user3 8
.8 9
GetUserIdFromJwt9 I
(I J
)J K
)K L
;L M
} 	
} 
} Á
}E:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\Validators\Interfaces\IValidator.cs
	namespace 	
Webshop
 
. 
BLL 
. 

Validators  
.  !

Interfaces! +
{ 
public		 

	interface		 

IValidator		 
{

 
bool 
Validate 
( 
) 
; 
} 
} ﬁ
ÖE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\ValueConverters\AlbumDisplayUrlConverter.cs
	namespace 	
Webshop
 
. 
BLL 
. 
ValueResolvers $
{ 
public 

class $
AlbumDisplayUrlConverter )
:* +
IValueConverter, ;
<; <
Caff< @
,@ A
stringB H
>H I
{ 
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly (
IWebshopConfigurationService 5!
_webshopConfiguration6 K
;K L
public $
AlbumDisplayUrlConverter '
(' ( 
IHttpContextAccessor( <
httpContextAccessor= P
,P Q(
IWebshopConfigurationServiceR n!
webshopConfiguration	o É
)
É Ñ
{ 	 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7!
_webshopConfiguration !
=" # 
webshopConfiguration$ 8
;8 9
} 	
public 
string 
Convert 
( 
Caff "
sourceMember# /
,/ 0
ResolutionContext1 B
contextC J
)J K
{ 	
var 
baseUrl 
= 
$" 
{  
_httpContextAccessor 1
.1 2
HttpContext2 =
.= >
Request> E
.E F
SchemeF L
}L M
$strM P
"P Q
+R S
$" 
{  
_httpContextAccessor '
.' (
HttpContext( 3
.3 4
Request4 ;
.; <
Host< @
}@ A
$strA B
{B C!
_webshopConfigurationC X
.X Y$
GetStaticFileRequestPathY q
(q r
)r s
}s t
$strt u
{u v"
_webshopConfiguration	v ã
.
ã å#
GetImagesSubdirectory
å °
(
° ¢
)
¢ £
}
£ §
"
§ •
;
• ¶
return 
sourceMember 
.  
Ciffs  %
.% &
Count& +
>, -
$num. /
?0 1
baseUrl2 9
+: ;
sourceMember< H
.H I
CiffsI N
.N O
FirstO T
(T U
)U V
.V W
DisplayPathW b
:c d
stringe k
.k l
Emptyl q
;q r
} 	
}   
}!! Ø
áE:\Desktop\Szamitogep_biztonsag\Szamitogep-biztonsag-VIHIMA06\Webshop\Backend\Webshop.BLL\ValueConverters\PictureDisplayUrlConverter.cs
	namespace 	
Webshop
 
. 
BLL 
. 
ValueResolvers $
{ 
public 

class &
PictureDisplayUrlConverter +
:, -
IValueConverter. =
<= >
Ciff> B
,B C
stringD J
>J K
{ 
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly (
IWebshopConfigurationService 5!
_webshopConfiguration6 K
;K L
public &
PictureDisplayUrlConverter )
() * 
IHttpContextAccessor* >
httpContextAccessor? R
,R S(
IWebshopConfigurationServiceT p!
webshopConfiguration	q Ö
)
Ö Ü
{ 	 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7!
_webshopConfiguration !
=" # 
webshopConfiguration$ 8
;8 9
} 	
public 
string 
Convert 
( 
Ciff "
sourceMember# /
,/ 0
ResolutionContext1 B
contextC J
)J K
{ 	
var 
baseUrl 
= 
$" 
{  
_httpContextAccessor 1
.1 2
HttpContext2 =
.= >
Request> E
.E F
SchemeF L
}L M
$strM P
"P Q
+R S
$" 
{  
_httpContextAccessor '
.' (
HttpContext( 3
.3 4
Request4 ;
.; <
Host< @
}@ A
$strA B
{B C!
_webshopConfigurationC X
.X Y$
GetStaticFileRequestPathY q
(q r
)r s
}s t
$strt u
{u v"
_webshopConfiguration	v ã
.
ã å#
GetImagesSubdirectory
å °
(
° ¢
)
¢ £
}
£ §
"
§ •
;
• ¶
return 
baseUrl 
+ 
sourceMember )
.) *
DisplayPath* 5
;5 6
} 	
}   
}!! 